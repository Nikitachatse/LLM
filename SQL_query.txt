STAGE 0 - Model Name :  Retail Model Variables
# TASK 0
Task Desc : Compute State National Macro Transformations
Target Map name : macro_economic_factors_state_derived_map
Target Table name : macro_economic_factors_state_derived
SQL : """SELECT macro_economic_factors.reporting_date as reporting_date, macro_economic_factors.scenario_code as scenario_code, macro_economic_factors.region_code as region_code, macro_economic_factors.prediction_year as prediction_year, macro_economic_factors.flbr as flbr, macro_economic_factors.hpi as hpi, COALESCE( ( ( (macro_economic_factors.flbr) - ( lag(macro_economic_factors.flbr, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.flbr, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ), 0 ) as six_m_flbr_state, COALESCE( ( ( (macro_economic_factors.flbr) - ( lag(macro_economic_factors.flbr, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.flbr, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ), 0 ) as yy_flbr_state, ( ( (macro_economic_factors.hpi) - ( lag(macro_economic_factors.hpi, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.hpi, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as hpi_state_b_6mgr, ( ( (macro_economic_factors.hpi) - ( lag(macro_economic_factors.hpi, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.hpi, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as yyhpi_state, 1743661739892 as version FROM e8b42496_f6bf_40cf_a6b0_f474982156ed_1616568520533_1616576719858 as macro_economic_factors JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((macro_economic_factors.reporting_date = reporting_date.reporting_date_name)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((macro_economic_factors.region_code = region.code)) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ( (macro_economic_factors.scenario_code = scenario.scenario_code) AND (macro_economic_factors.reporting_date > scenario.eff_start_date) AND (macro_economic_factors.reporting_date <= scenario.eff_end_date) ) WHERE (1 = 1) AND (((region.level_desc = 'State')))"""

# TASK 1
Task Desc : Compute National Level Macro Transformations
Target Map name : macro_economic_factors_national_derived_map
Target Table name : macro_economic_factors_national_derived
SQL : """WITH macro_economic_factors_national_derived_map_dlagcalc_base AS ( SELECT macro_economic_factors.reporting_date as reporting_date, macro_economic_factors.scenario_code as scenario_code, macro_economic_factors.region_code as region_code, macro_economic_factors.prediction_year as prediction_year, macro_economic_factors.flbr as flbr, macro_economic_factors.hpi as hpi, macro_economic_factors.IndProdVeh as indprodveh, macro_economic_factors.CpiAuto as cpiauto, macro_economic_factors.GrossSavings as grosssavings, macro_economic_factors.GDP09Ind as gdp09ind, macro_economic_factors.CpiGas as cpigas, macro_economic_factors.DelqAutoInd as delqautoind, macro_economic_factors.PceTotal as pcetotal, COALESCE( ( ( (macro_economic_factors.flbr) - ( lag(macro_economic_factors.flbr, 3) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.flbr, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ), 0 ) as six_m_flbr, COALESCE( ( ( (macro_economic_factors.flbr) - ( lag(macro_economic_factors.flbr, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.flbr, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ), 0 ) as yy_flbr, ( ( (macro_economic_factors.CpiGas) - ( lag(macro_economic_factors.CpiGas, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.CpiGas, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as f_6m_cpigas_gr, ( ( (macro_economic_factors.CpiGas) - ( lag(macro_economic_factors.CpiGas, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.CpiGas, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as y_cpigas_gr, ( ( (macro_economic_factors.hpi) - ( lag(macro_economic_factors.hpi, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.hpi, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as hpi_national_6mgr, ( ( (macro_economic_factors.hpi) - ( lag(macro_economic_factors.hpi, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.hpi, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as yyhpi_us, ( ( (macro_economic_factors.IndProdVeh) - ( lag(macro_economic_factors.IndProdVeh, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.IndProdVeh, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as f_6m_indprodveh_gr, ( ( (macro_economic_factors.IndProdVeh) - ( lag(macro_economic_factors.IndProdVeh, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.IndProdVeh, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as y_indprodveh_gr, ( ( (macro_economic_factors.CpiAuto) - ( lag(macro_economic_factors.CpiAuto, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.CpiAuto, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as f_6m_cpiauto_gr, ( ( (macro_economic_factors.CpiAuto) - ( lag(macro_economic_factors.CpiAuto, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.CpiAuto, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as y_cpiauto_gr, ( ( (macro_economic_factors.GrossSavings) - ( lag(macro_economic_factors.GrossSavings, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.GrossSavings, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as f_6m_grosssavings_gr, ( ( (macro_economic_factors.GrossSavings) - ( lag(macro_economic_factors.GrossSavings, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.GrossSavings, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as y_grosssavings_gr, ( ( (macro_economic_factors.GDP09Ind) - ( lag(macro_economic_factors.GDP09Ind, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.GDP09Ind, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as f_6m_gdp09ind_gr, ( ( (macro_economic_factors.GDP09Ind) - ( lag(macro_economic_factors.GDP09Ind, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.GDP09Ind, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as y_gdp09ind_gr, ( (macro_economic_factors.flbr) - ( lag(macro_economic_factors.flbr, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) as ay_unemplrate, ( ( (macro_economic_factors.CpiAuto) - ( lag(macro_economic_factors.CpiAuto, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) ) / ( lag(macro_economic_factors.CpiAuto, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as y_cpiauto, ( ( (macro_economic_factors.PceTotal) - ( lag(macro_economic_factors.PceTotal, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) ) / ( lag(macro_economic_factors.PceTotal, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as q_pcetotal, ( lag(macro_economic_factors.DelqAutoInd, 1) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as l1_delqautoind, 1743661740452 as version, ( ( (macro_economic_factors.Manheim) - ( lag(macro_economic_factors.Manheim, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.Manheim, 2) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as 6m_Manheim_gr, ( ( (macro_economic_factors.Manheim) - ( lag(macro_economic_factors.Manheim, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) ) * 100 ) / ( lag(macro_economic_factors.Manheim, 4) over ( partition by macro_economic_factors.region_code order by macro_economic_factors.prediction_year ) ) as y_Manheim_gr, macro_economic_factors.Manheim as Manheim FROM e8b42496_f6bf_40cf_a6b0_f474982156ed_1616568520533_1616576719858 as macro_economic_factors JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((macro_economic_factors.reporting_date = reporting_date.reporting_date_name)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((macro_economic_factors.region_code = region.code)) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ( (macro_economic_factors.scenario_code = scenario.scenario_code) AND (macro_economic_factors.reporting_date > scenario.eff_start_date) AND (macro_economic_factors.reporting_date <= scenario.eff_end_date) ) WHERE (1 = 1) AND (((region.level_desc = 'Country'))) SORT BY macro_economic_factors.reporting_date, macro_economic_factors.scenario_code, macro_economic_factors.region_code, macro_economic_factors.prediction_year ), macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc AS ( SELECT macro_economic_factors_national_derived_map_dlagcalc_base.scenario_code, macro_economic_factors_national_derived_map_dlagcalc_base.reporting_date, macro_economic_factors_national_derived_map_dlagcalc_base.region_code, dlagcalc11 ( sort_array ( collect_list ( struct ( macro_economic_factors_national_derived_map_dlagcalc_base.prediction_year, array ( CASE WHEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.prediction_year AS DOUBLE) IS NOT NULL THEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.prediction_year AS DOUBLE) ELSE 0d END, CASE WHEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.f_6m_cpiauto_gr AS DOUBLE) IS NOT NULL THEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.f_6m_cpiauto_gr AS DOUBLE) ELSE 0d END, CASE WHEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_cpiauto_gr AS DOUBLE) IS NOT NULL THEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_cpiauto_gr AS DOUBLE) ELSE 0d END, CASE WHEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.ay_unemplrate AS DOUBLE) IS NOT NULL THEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.ay_unemplrate AS DOUBLE) ELSE 0d END, CASE WHEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_cpiauto AS DOUBLE) IS NOT NULL THEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_cpiauto AS DOUBLE) ELSE 0d END, CASE WHEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.q_pcetotal AS DOUBLE) IS NOT NULL THEN CAST(macro_economic_factors_national_derived_map_dlagcalc_base.q_pcetotal AS DOUBLE) ELSE 0d END, 0d, 0d, 0d, 0d, 0d ) as inputValueArr ) ) ), ' y_cpiauto; q_pcetotal; f_6m_cpiauto_gr; y_cpiauto_gr; ay_unemplrate', ' y_cpiauto$dlag1; q_pcetotal$dlag1; f_6m_cpiauto_gr$dlag1; y_cpiauto_gr$dlag1; ay_unemplrate$dlag1', 'prediction_year,f_6m_cpiauto_gr,y_cpiauto_gr,ay_unemplrate,y_cpiauto,q_pcetotal,yl1_cpiauto,ql1_pcetotal,f_6ml1_cpiauto_gr,yl1_cpiauto_gr,ayl1_unemplrate,prediction_year$dlag1,f_6m_cpiauto_gr$dlag1,y_cpiauto_gr$dlag1,ay_unemplrate$dlag1,y_cpiauto$dlag1,q_pcetotal$dlag1,yl1_cpiauto$dlag1,ql1_pcetotal$dlag1,f_6ml1_cpiauto_gr$dlag1,yl1_cpiauto_gr$dlag1,ayl1_unemplrate$dlag1', '1743661740452_0_1' ) AS macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols FROM macro_economic_factors_national_derived_map_dlagcalc_base AS macro_economic_factors_national_derived_map_dlagcalc_base GROUP BY macro_economic_factors_national_derived_map_dlagcalc_base.scenario_code, macro_economic_factors_national_derived_map_dlagcalc_base.reporting_date, macro_economic_factors_national_derived_map_dlagcalc_base.region_code ), macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode AS ( SELECT macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc.scenario_code, macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc.reporting_date, macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc.region_code, explode (macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols) AS macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols FROM macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc ) ( SELECT CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.scenario_code AS string) AS scenario_code, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.reporting_date AS string) AS reporting_date, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.region_code AS string) AS region_code, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.flbr AS double) AS flbr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.hpi AS double) AS hpi, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.indprodveh AS double) AS indprodveh, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.cpiauto AS double) AS cpiauto, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.grosssavings AS double) AS grosssavings, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.gdp09ind AS double) AS gdp09ind, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.cpigas AS double) AS cpigas, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.delqautoind AS double) AS delqautoind, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.pcetotal AS double) AS pcetotal, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.six_m_flbr AS double) AS six_m_flbr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.yy_flbr AS double) AS yy_flbr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.f_6m_cpigas_gr AS double) AS f_6m_cpigas_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_cpigas_gr AS double) AS y_cpigas_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.hpi_national_6mgr AS double) AS hpi_national_6mgr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.yyhpi_us AS double) AS yyhpi_us, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.f_6m_indprodveh_gr AS double) AS f_6m_indprodveh_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_indprodveh_gr AS double) AS y_indprodveh_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.f_6m_grosssavings_gr AS double) AS f_6m_grosssavings_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_grosssavings_gr AS double) AS y_grosssavings_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.f_6m_gdp09ind_gr AS double) AS f_6m_gdp09ind_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_gdp09ind_gr AS double) AS y_gdp09ind_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.l1_delqautoind AS double) AS l1_delqautoind, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.version AS long) AS version, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.6m_Manheim_gr AS double) AS 6m_Manheim_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.y_Manheim_gr AS double) AS y_Manheim_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base.Manheim AS double) AS Manheim, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_0 AS string) AS prediction_year, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_1 AS double) AS f_6m_cpiauto_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_2 AS double) AS y_cpiauto_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_3 AS double) AS ay_unemplrate, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_4 AS double) AS y_cpiauto, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_5 AS double) AS q_pcetotal, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_6 AS double) AS yl1_cpiauto, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_7 AS double) AS ql1_pcetotal, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_8 AS double) AS f_6ml1_cpiauto_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_9 AS double) AS yl1_cpiauto_gr, CAST(macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_10 AS double) AS ayl1_unemplrate FROM macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode JOIN macro_economic_factors_national_derived_map_dlagcalc_base ON macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.reporting_date = macro_economic_factors_national_derived_map_dlagcalc_base.reporting_date AND macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.scenario_code = macro_economic_factors_national_derived_map_dlagcalc_base.scenario_code AND macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.region_code = macro_economic_factors_national_derived_map_dlagcalc_base.region_code AND macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_explode.macro_economic_factors_national_derived_map_dlagcalc_base_dlagcalc_allcols.column_0 = macro_economic_factors_national_derived_map_dlagcalc_base.prediction_year ) """

# TASK 2
Task Desc : Compute Loan Level variable derivations
Target Map name : retail_model_variables_map
Target Table name : retail_model_variables
SQL : """ WITH instrument_auto_derived_map AS ( SELECT instrument_detail_retail.data_as_of_date as reporting_date, instrument_detail_retail.loan_key as instrument_id, portfolio.id as portfolio_id, 16 as scenario_id, prediction_year.prediction_year_name as prediction_year, instrument_detail_retail.contract_date as contract_date, CAST(last_day(concat(substr(instrument_detail_retail.vintage_month_key, 1, 4), '-', substr(instrument_detail_retail.vintage_month_key, 5, 2), '-01')) AS string) as date_vintage, instrument_detail_retail.loan_state_key as loan_state_key, instrument_detail_retail.loan_status_code as loan_status_code, instrument_detail_retail.account_nbr as account_nbr, instrument_detail_retail.portfolio_channel_name as portfolio_channel_name, instrument_detail_retail.full_pool_name as full_pool_name, instrument_detail_retail.first_tdr_date as scusa_first_tdr_date, instrument_detail_retail.first_tdr_reason_desc as scusa_first_tdr_reason_desc, instrument_detail_retail.custom_flag as sdart_flag, instrument_detail_retail.country_flag as spain_flag, instrument_detail_retail.accrued_interest_amt as accrued_interest_amt, instrument_detail_retail.all_eligibility_ind as all_eligibility_ind, instrument_detail_retail.apr_pct as apr_pct, instrument_detail_retail.bankruptcy_key as bankruptcy_key, instrument_detail_retail.tdr_adjusted_balance_amt as tdr_adjusted_balance_amt, instrument_detail_retail.bk_write_down_ind as bk_write_down_ind, instrument_detail_retail.class_code as class_code, instrument_detail_retail.vintage_month_key as vintage_month_key, instrument_detail_retail.gl_account_nbr as gl_account_nbr, instrument_detail_retail.maturity_date as maturity_date, instrument_detail_retail.term_nbr as Term_Nbr, instrument_detail_retail.ltv_pct as LTV_Pct, instrument_detail_retail.collateral_type_desc as Collateral_Type_Desc, instrument_detail_retail.bom_balance_amt as bom_balance_amt, instrument_detail_retail.eom_balance_amt as eom_balance_amt, instrument_detail_retail.delinquency_31plus_ind as Delinquency_31Plus_Ind, instrument_detail_retail.delinquency_61plus_ind as Delinquency_61Plus_Ind, instrument_detail_retail.delinquency_91plus_ind as Delinquency_91Plus_Ind, instrument_detail_retail.loss_forecast_score_nbr as loss_forecast_score_nbr, instrument_detail_retail.total_discount_amt as Total_discount_amt, prediction_year.prediction_year_name as date_performance_num, CAST(floor((months_between (prediction_year.prediction_year_name, IF (instrument_detail_retail.vintage_type = 'New', instrument_detail_retail.new_vintage_date, CAST(last_day(concat(substr(instrument_detail_retail.vintage_month_key, 1, 4), '-', substr(instrument_detail_retail.vintage_month_key, 5, 2), '-01')) AS string)))) / 3) as double) as date_qob, ( months_between ( prediction_year.prediction_year_name, CASE WHEN (((instrument_detail_retail.vintage_type = 'New'))) THEN (instrument_detail_retail.new_vintage_date) ELSE (reporting_date.quarter_end_date) END ) ) / 3 as date_qss, CASE WHEN ((((UPPER(instrument_detail_retail.tdr_accrual_status)) like 'NONACCRUE-TDR-6PA%'))) THEN ('NonAccrue-TDR-6PaymentsMade') ELSE (instrument_detail_retail.tdr_accrual_status) END as tdr_accrual_status, YEAR(prediction_year.prediction_year_name) * 10 + quarter (prediction_year.prediction_year_name) as mq, YEAR(instrument_detail_retail.maturity_date) * 10 + quarter (instrument_detail_retail.maturity_date) as mq_maturity, YEAR(prediction_year.prediction_year_name) * 10 + quarter (prediction_year.prediction_year_name) as date_snap_mq, instrument_detail_retail.ltv_pct as snap_ltv_pct, instrument_detail_retail.thin_file_ind as thin_ind, instrument_detail_retail.collateral_type_desc as coll_type, instrument_detail_retail.residence_state_code as state, instrument_detail_retail.eom_balance_amt as eoq_balance_amt, instrument_detail_retail.eom_balance_amt as snap_bal_eoq, instrument_detail_retail.eom_balance_amt as boq_balance_amt, instrument_detail_retail.days_past_due_nbr as days_past_due, instrument_detail_retail.days_past_due_nbr as snap_dpd, CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END as flag_tdr, CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END as snap_tdr, instrument_detail_retail.delinquency_31plus_ind as snap_delq31, instrument_detail_retail.delinquency_61plus_ind as snap_delq61, instrument_detail_retail.delinquency_91plus_ind as snap_delq91, CAST(floor((months_between (reporting_date.quarter_end_date, CAST(last_day(concat(substr(instrument_detail_retail.vintage_month_key, 1, 4), '-', substr(instrument_detail_retail.vintage_month_key, 5, 2), '-01')) AS string))) / 3) as double) as snap_date_qob, instrument_detail_retail.current_credit_score_nbr as lfs, instrument_detail_retail.current_credit_score_nbr as snap_lfs, instrument_detail_retail.loss_forecast_score_nbr as snap_lossforecastscore, instrument_detail_retail.original_credit_score_nbr as credit_score_orig, instrument_detail_retail.original_credit_score_nbr as snap_fico, instrument_detail_retail.total_discount_amt as snap_tda, instrument_detail_retail.scheduled_payment_amt as sched_pmt, instrument_detail_retail.current_interest_rate as current_int_rate, instrument_detail_retail.new_used_code as new_used, CASE WHEN (((instrument_detail_retail.total_income_amt = 0))) THEN (null) ELSE (instrument_detail_retail.total_income_amt) END as total_income_amt, CASE WHEN ( ( (instrument_detail_retail.scheduled_payment_amt > 0) AND (instrument_detail_retail.total_income_amt > 0) ) ) THEN (instrument_detail_retail.scheduled_payment_amt / instrument_detail_retail.total_income_amt * 100) ELSE (null) END as pti_pct, CASE WHEN (((instrument_detail_retail.days_past_due_nbr > 60))) THEN (1) WHEN ((((CAST(floor((months_between (prediction_year.prediction_year_name, CAST(last_day(concat(substr(instrument_detail_retail.vintage_month_key, 1, 4), '-', substr(instrument_detail_retail.vintage_month_key, 5, 2), '-01')) AS string)))) as double)) <= 9))) THEN (2) WHEN ( ( ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (3) ELSE (4) END as seg_default, CASE WHEN (((instrument_detail_retail.days_past_due_nbr > 60))) THEN (1) WHEN ((((CAST(floor((months_between (reporting_date.quarter_end_date, IF (instrument_detail_retail.vintage_type = 'New', instrument_detail_retail.new_vintage_date, CAST(last_day(concat(substr(instrument_detail_retail.vintage_month_key, 1, 4), '-', substr(instrument_detail_retail.vintage_month_key, 5, 2), '-01')) AS string)))) / 3) as double)) <= 9))) THEN (2) WHEN ( ( ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (3) ELSE (4) END as snap_segdefault, CASE WHEN (((instrument_detail_retail.delinquency_61plus_ind = 'Y'))) THEN (1) WHEN (((((months_between (prediction_year.prediction_year_name, (last_day(instrument_detail_retail.contract_date)))) / 3) <= 3))) THEN (2) WHEN ( ( ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (3) WHEN (((instrument_detail_retail.finance_company_id = 8))) THEN (5) ELSE (4) END as seg_payoff, CASE WHEN (((instrument_detail_retail.delinquency_61plus_ind = 'Y'))) THEN (1) WHEN (((((months_between (prediction_year.prediction_year_name, (last_day(instrument_detail_retail.contract_date)))) / 3) <= 3))) THEN (2) WHEN ( ( ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (3) WHEN (((instrument_detail_retail.finance_company_id = 8))) THEN (5) ELSE (4) END as snap_segpayoff, CASE WHEN ( ( ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (1) WHEN (((instrument_detail_retail.finance_company_id = 8))) THEN (3) ELSE (2) END as seg_ead, CASE WHEN ( ( ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (1) WHEN (((instrument_detail_retail.finance_company_id = 8))) THEN (3) ELSE (2) END as snap_seg_ead, CASE WHEN (((instrument_detail_retail.original_commitment_amt = 0))) THEN (null) ELSE (instrument_detail_retail.original_commitment_amt) END as original_commitment, CASE WHEN (((instrument_detail_retail.original_commitment_amt = 0))) THEN (null) ELSE (instrument_detail_retail.original_commitment_amt) END as snap_orig_comm, instrument_detail_retail.total_discount_amt / CASE WHEN (((instrument_detail_retail.original_commitment_amt = 0))) THEN (null) ELSE (instrument_detail_retail.original_commitment_amt) END as snap_disoverfin, instrument_detail_retail.collateral_market_value_amt as market_value, CASE WHEN (((instrument_detail_retail.collateral_market_value_amt = 0))) THEN (null) ELSE (instrument_detail_retail.collateral_market_value_amt) END as snap_market_value, instrument_detail_retail.effective_interest_rate as eff_rate, instrument_detail_retail.term_nbr / 12 as term_yr, CAST(floor((months_between (prediction_year.prediction_year_name, CAST(last_day(concat(substr(instrument_detail_retail.vintage_month_key, 1, 4), '-', substr(instrument_detail_retail.vintage_month_key, 5, 2), '-01')) AS string)))) as double) as date_mob, instrument_detail_retail.ltd_extension_cnt as ltd_extension_cnt, instrument_detail_retail.ltd_extension_nbr as ltd_extension_nbr, 1743661746824 as version, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Undefined'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Cabover'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Commercial Van'))) THEN ('Van') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact Utility'))) THEN ('Small SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Conventional'))) THEN ('Other') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Entry Subcompact'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Extended Hood'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Heavy Duty Cabover'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Highway Aerodynamic'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Highway Traditional'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Intermediate Compact'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Intermediate Mid-Size'))) THEN ('Mid Size Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Intermediate Subcompact'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Car'))) THEN ('Large Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Pickup'))) THEN ('Large Pickup') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large SUV'))) THEN ('Large SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Van'))) THEN ('Van') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Local/Delivery Daycab'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Low Cab Forward'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Luxury Compact Utility'))) THEN ('Small SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Luxury Large'))) THEN ('Large Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Luxury Large Truck'))) THEN ('Large Pickup') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Luxury Mid-Size'))) THEN ('Mid Size Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Luxury Mid-Size Utility'))) THEN ('Mid Size SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Luxury Sport'))) THEN ('Sports Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Medium Duty Cabover'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Medium Duty Conventional'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Mid-Size Pickup'))) THEN ('Compact/Midsize Pickup') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Mid-Size Utility'))) THEN ('Mid Size SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Mid-Size Van'))) THEN ('Van') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'N/A'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Near Luxury'))) THEN ('Luxury') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Premium Luxury Large'))) THEN ('Large Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Sport'))) THEN ('Sports Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Ultra Luxury/Exotic'))) THEN ('Luxury') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Upper Compact'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Upper Mid-Size'))) THEN ('Mid Size Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Upper Sport'))) THEN ('Sports Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Vocational/Construction'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Trailers'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Advanced Build/Residual'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Not Available'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Undefined'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Commercial Van'))) THEN ('Van') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact Car'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact MPV'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact Premium Car'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact Premium Sporty Car'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact Premium SUV'))) THEN ('Small SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact Sporty Car'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact SUV'))) THEN ('Small SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Extended Hood'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Heavy Duty Cabover'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Highway Aerodynamic'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Highway Traditional'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Car'))) THEN ('Large Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Light Duty Pickup'))) THEN ('Large Pickup') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Pickup - Heavy Duty'))) THEN ('Large Pickup') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Pickup - Light Duty'))) THEN ('Large Pickup') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Premium Car'))) THEN ('Large Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Premium SUV'))) THEN ('Large SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large SUV'))) THEN ('Large SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Van'))) THEN ('Van') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Local/Delivery Daycab'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Low Cab Forward'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Medium Duty Cabover'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Medium Duty Conventional'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Midsize Car'))) THEN ('Mid Size Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Midsize Pickup'))) THEN ('Compact/Midsize Pickup') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Midsize Premium Car'))) THEN ('Mid Size Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Midsize Premium Sporty Car'))) THEN ('Mid Size Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Midsize Premium SUV'))) THEN ('Mid Size SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Midsize Sporty Car'))) THEN ('Mid Size Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Midsize SUV'))) THEN ('Mid Size SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Midsize Van'))) THEN ('Van') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'N/A'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Not Available'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Small Car'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Small Premium Car'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Small Premium SUV'))) THEN ('Small SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Small SUV'))) THEN ('Small SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Trailers'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Ultra Luxury/Exotic'))) THEN ('Luxury') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Vocational/Construction'))) THEN ('Others') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact Pickup'))) THEN ('Compact/Midsize Pickup') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Mid-Size SUV'))) THEN ('Mid Size SUV') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Near Luxury Compact'))) THEN ('Compact Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Premium Luxury Mid-Size'))) THEN ('Mid Size Car') WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'NULL'))) THEN ('Others') ELSE ('Others') END as vehicle_model_segment FROM f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = instrument_detail_retail.data_as_of_date)) JOIN 2f280b7c_7470_45d7_a8cb_b2fa4e277191_1616568471162_1616570841582 as prediction_year on ((prediction_year.prediction_year_name >= instrument_detail_retail.data_as_of_date)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ( (instrument_detail_retail.portfolio_code = portfolio.code) AND (instrument_detail_retail.data_as_of_date >= portfolio.eff_start_date) AND (instrument_detail_retail.data_as_of_date <= portfolio.eff_end_date) ) WHERE (1 = 1) AND ( ( (instrument_detail_retail.all_eligibility_ind = 'Y') OR (instrument_detail_retail.country_flag = 'Y') ) ) AND (((prediction_year.prediction_year_name <= (add_months(IF (instrument_detail_retail.vintage_type = 'New', instrument_detail_retail.new_vintage_date, reporting_date.quarter_end_date), 96))))) AND ( ( ( prediction_year.prediction_year_name >= ( CASE WHEN (((instrument_detail_retail.vintage_type = 'New'))) THEN (instrument_detail_retail.new_vintage_date) ELSE (instrument_detail_retail.data_as_of_date) END ) ) ) ) AND ((((CAST(month (prediction_year.prediction_year_name) as int)) IN (3, 6, 9, 12)))) ) SELECT instrument_retail_derived.reporting_date as reporting_date, instrument_retail_derived.instrument_id as instrument_id, instrument_retail_derived.prediction_year as prediction_year, instrument_retail_derived.portfolio_id as portfolio_id, instrument_retail_derived.scenario_id as scenario_id, instrument_retail_derived.term_yr as term_yr, CASE WHEN ((((Quarter (instrument_retail_derived.prediction_year)) in (1, 2)))) THEN (1) ELSE (0) END as 1stHalf, CASE WHEN ((((Quarter (instrument_retail_derived.prediction_year)) in (3, 4)))) THEN (1) ELSE (0) END as 2ndHalf, CASE WHEN ((((Quarter (instrument_retail_derived.prediction_year)) = 1))) THEN (1) ELSE (0) END as qtr1, CASE WHEN ((((Quarter (instrument_retail_derived.prediction_year)) = 2))) THEN (1) ELSE (0) END as qtr2, CASE WHEN ((((Quarter (instrument_retail_derived.prediction_year)) = 3))) THEN (1) ELSE (0) END as qtr3, CASE WHEN ((((Quarter (instrument_retail_derived.prediction_year)) = 4))) THEN (1) ELSE (0) END as qtr4, instrument_retail_derived.date_qob as date_qob, instrument_retail_derived.date_qss as date_qss, CASE WHEN ( ( (instrument_retail_derived.date_qob >= 0) AND (instrument_retail_derived.date_qob <= 1) ) ) THEN (1) ELSE (0) END as age0_1_f, CASE WHEN ( ( (instrument_retail_derived.date_qob > 1) AND (instrument_retail_derived.date_qob <= 3) ) ) THEN (1) ELSE (0) END as age2_3_f, CASE WHEN ( ( (instrument_retail_derived.date_qob > 3) AND (instrument_retail_derived.date_qob <= 9) ) ) THEN (1) ELSE (0) END as age4_9_f, CASE WHEN ( ( (instrument_retail_derived.date_qob > 9) AND (instrument_retail_derived.date_qob <= 12) ) ) THEN (1) ELSE (0) END as age10_12_f, CASE WHEN ( ( (instrument_retail_derived.date_qob > 12) AND (instrument_retail_derived.date_qob <= 16) ) ) THEN (1) ELSE (0) END as age13_16_f, CASE WHEN (((instrument_retail_derived.date_qob > 16))) THEN (1) ELSE (0) END as age17_f, CASE WHEN ( ( (instrument_retail_derived.date_qob > 3) AND (instrument_retail_derived.date_qob <= 6) ) ) THEN (1) ELSE (0) END as age4_6_pd3, CASE WHEN ( ( (instrument_retail_derived.date_qob > 6) AND (instrument_retail_derived.date_qob <= 24) ) ) THEN (1) ELSE (0) END as age7_24_pd3, CASE WHEN ( ( (instrument_retail_derived.date_qob > 24) AND (instrument_retail_derived.date_qob <= 36) ) ) THEN (1) ELSE (0) END as age25_36_pd3, CASE WHEN ( ( (instrument_retail_derived.date_qob > 36) AND (instrument_retail_derived.date_qob <= 39) ) ) THEN (1) ELSE (0) END as age37_39_pd3, CASE WHEN (((instrument_retail_derived.date_qob > 39))) THEN (1) ELSE (0) END as age40_pd3, CASE WHEN ( ( (instrument_retail_derived.date_qob > 3) AND (instrument_retail_derived.date_qob <= 9) ) ) THEN (1) ELSE (0) END as age4_9_pd4, CASE WHEN ( ( (instrument_retail_derived.date_qob > 9) AND (instrument_retail_derived.date_qob <= 22) ) ) THEN (1) ELSE (0) END as age10_22_pd4, CASE WHEN ( ( (instrument_retail_derived.date_qob > 22) AND (instrument_retail_derived.date_qob <= 26) ) ) THEN (1) ELSE (0) END as age23_26_pd4, CASE WHEN (((instrument_retail_derived.date_qob > 26))) THEN (1) ELSE (0) END as age27_pd4, CASE WHEN ( ( (instrument_retail_derived.date_qob >= 0) AND (instrument_retail_derived.date_qob <= 2) ) ) THEN (1) ELSE (0) END as age0_2_po1, CASE WHEN ( ( (instrument_retail_derived.date_qob > 2) AND (instrument_retail_derived.date_qob <= 30) ) ) THEN (1) ELSE (0) END as age3_30_po1, CASE WHEN ( ( (instrument_retail_derived.date_qob > 30) AND (instrument_retail_derived.date_qob <= 37) ) ) THEN (1) ELSE (0) END as age31_37_po1, CASE WHEN (((instrument_retail_derived.date_qob > 37))) THEN (1) ELSE (0) END as age38_po1, CASE WHEN ( ( (instrument_retail_derived.date_qob > 3) AND (instrument_retail_derived.date_qob <= 9) ) ) THEN (1) ELSE (0) END as age4_9_po3, CASE WHEN ( ( (instrument_retail_derived.date_qob > 9) AND (instrument_retail_derived.date_qob <= 12) ) ) THEN (1) ELSE (0) END as age10_12_po3, CASE WHEN ( ( (instrument_retail_derived.date_qob > 12) AND (instrument_retail_derived.date_qob <= 23) ) ) THEN (1) ELSE (0) END as age13_23_po3, CASE WHEN (((instrument_retail_derived.date_qob > 23))) THEN (1) ELSE (0) END as age24_po3, CASE WHEN ( ( (instrument_retail_derived.date_qob > 3) AND (instrument_retail_derived.date_qob <= 15) ) ) THEN (1) ELSE (0) END as age4_15_po4_v2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 15) AND (instrument_retail_derived.date_qob <= 19) ) ) THEN (1) ELSE (0) END as age15_19_po4_v2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 19) AND (instrument_retail_derived.date_qob <= 24) ) ) THEN (1) ELSE (0) END as age20_24_po4_v2, CASE WHEN (((instrument_retail_derived.date_qob > 24))) THEN (1) ELSE (0) END as age25_po4_v2, CASE WHEN ( ( (instrument_retail_derived.date_qss >= 0) AND (instrument_retail_derived.date_qss <= 1) ) ) THEN (1) ELSE (0) END as qss0_1_f, CASE WHEN ( ( (instrument_retail_derived.date_qss > 1) AND (instrument_retail_derived.date_qss <= 3) ) ) THEN (1) ELSE (0) END as qss2_3_f, CASE WHEN ( ( (instrument_retail_derived.date_qss > 3) AND (instrument_retail_derived.date_qss <= 9) ) ) THEN (1) ELSE (0) END as qss4_9_f, CASE WHEN ( ( (instrument_retail_derived.date_qss > 9) AND (instrument_retail_derived.date_qss <= 12) ) ) THEN (1) ELSE (0) END as qss10_12_f, CASE WHEN (((instrument_retail_derived.date_qss > 12))) THEN (1) ELSE (0) END as qss13_f, CASE WHEN ( ( (instrument_retail_derived.date_qss >= 0) AND (instrument_retail_derived.date_qss <= 1) ) ) THEN (1) ELSE (0) END as qss0_1_po1, CASE WHEN ( ( (instrument_retail_derived.date_qss > 1) AND (instrument_retail_derived.date_qss <= 7) ) ) THEN (1) ELSE (0) END as qss2_7_po1, CASE WHEN ( ( (instrument_retail_derived.date_qss > 7) AND (instrument_retail_derived.date_qss <= 9) ) ) THEN (1) ELSE (0) END as qss8_9_po1, CASE WHEN ( ( (instrument_retail_derived.date_qss > 9) AND (instrument_retail_derived.date_qss <= 13) ) ) THEN (1) ELSE (0) END as qss10_13_po1, CASE WHEN (((instrument_retail_derived.date_qss > 13))) THEN (1) ELSE (0) END as qss14_po1, instrument_retail_derived.pti_pct as pti_pct, CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 8) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.pti_pct >= 8) AND (instrument_retail_derived.pti_pct < 9) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.pti_pct >= 9) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.pti_pct >= 10) AND (instrument_retail_derived.pti_pct < 11) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.pti_pct >= 11) AND (instrument_retail_derived.pti_pct < 12) ) ) THEN (6) ELSE (7) END as bin_pti_f, CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 0.0977216) ) ) THEN (2) WHEN (((instrument_retail_derived.pti_pct >= 0.0977216))) THEN (3) ELSE (1) END as bin_pti_f_2, CASE WHEN (((instrument_retail_derived.LTV_Pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.LTV_Pct > 0) AND (instrument_retail_derived.LTV_Pct < 90.556856781) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.LTV_Pct >= 90.556856781) AND (instrument_retail_derived.LTV_Pct < 99.6) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.LTV_Pct >= 99.6) AND (instrument_retail_derived.LTV_Pct < 105.49298845) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.LTV_Pct >= 105.49298845) AND (instrument_retail_derived.LTV_Pct < 110.16685039) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.LTV_Pct >= 110.16685039) AND (instrument_retail_derived.LTV_Pct < 118.18181818) ) ) THEN (6) WHEN (((instrument_retail_derived.LTV_Pct >= 118.18181818))) THEN (7) ELSE (1) END as bin_oltv_f, CASE WHEN (((instrument_retail_derived.LTV_Pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.LTV_Pct > 0) AND (instrument_retail_derived.LTV_Pct < 115) ) ) THEN (2) ELSE (3) END as bin_oltv_f_2, CASE WHEN (((instrument_retail_derived.LTV_Pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.LTV_Pct > 0) AND (instrument_retail_derived.LTV_Pct < 92) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.LTV_Pct >= 92) AND (instrument_retail_derived.LTV_Pct < 100) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.LTV_Pct >= 100) AND (instrument_retail_derived.LTV_Pct < 110) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.LTV_Pct >= 110) AND (instrument_retail_derived.LTV_Pct < 118) ) ) THEN (5) ELSE (6) END as bin_oltv_f_3, CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END as bin_snap_fico_f, CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 300) AND (instrument_retail_derived.snap_lfs < 570) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 570) AND (instrument_retail_derived.snap_lfs <= 850) ) ) THEN (3) ELSE (1) END as bin_snap_fico_f_2, CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 518) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 518) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 618) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 618) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (5) ELSE (1) END as bin_snap_fico_po, CASE WHEN (((instrument_retail_derived.term_yr = null))) THEN (1) WHEN ( ( (instrument_retail_derived.term_yr > 0) AND (instrument_retail_derived.term_yr < 5) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.term_yr >= 5) AND (instrument_retail_derived.term_yr < 6) ) ) THEN (3) WHEN (((instrument_retail_derived.term_yr >= 6))) THEN (4) ELSE (1) END as bin_termyr_f, CASE WHEN (((instrument_retail_derived.term_yr = null))) THEN (1) WHEN ( ( (instrument_retail_derived.term_yr > 0) AND (instrument_retail_derived.term_yr <= 6) ) ) THEN (2) WHEN (((instrument_retail_derived.term_yr > 6))) THEN (3) ELSE (1) END as bin_termyr_f_2, CASE WHEN (((instrument_retail_derived.snap_dpd < 0))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_dpd > 0) AND (instrument_retail_derived.snap_dpd <= 30) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_dpd > 30) AND (instrument_retail_derived.snap_dpd <= 60) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_dpd > 60) AND (instrument_retail_derived.snap_dpd <= 90) ) ) THEN (4) WHEN (((instrument_retail_derived.snap_dpd > 90))) THEN (5) ELSE (1) END as bin_snapDPD_f, CASE WHEN ( ( (instrument_retail_derived.thin_ind IS null) OR (instrument_retail_derived.thin_ind = 'U') ) ) THEN (1) WHEN (((instrument_retail_derived.thin_ind = 'Y'))) THEN (2) WHEN (((instrument_retail_derived.thin_ind = 'N'))) THEN (3) ELSE (1) END as bin_thin_f, CASE WHEN (((instrument_retail_derived.coll_type = 'AUTO LOANS - SERVICED'))) THEN (1) ELSE (0) END as serviced, instrument_retail_derived.state as state, CASE WHEN (((instrument_retail_derived.state not in ('AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT', 'DC', 'DE', 'FL', 'GA', 'HI', 'IA', 'ID', 'IL', 'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME', 'MI', 'MN', 'MO', 'MS', 'MT', 'NC', 'ND', 'NE', 'NH', 'NJ', 'NM', 'NV', 'NY', 'OH', 'OK', 'OR', 'PA', 'PR', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VA', 'VT', 'WA', 'WI', 'WV', 'WY')))) THEN (1) ELSE (0) END as state_id_invalid, instrument_retail_derived.snap_segdefault as snap_segdefault, CASE WHEN ((((MOD (instrument_retail_derived.mq, 10)) = 1))) THEN (1) ELSE (0) END as qtr_dummy_1_ead, CASE WHEN ((((MOD (instrument_retail_derived.mq, 10)) = 2))) THEN (1) ELSE (0) END as qtr_dummy_2_ead, CASE WHEN ((((MOD (instrument_retail_derived.mq, 10)) = 3))) THEN (1) ELSE (0) END as qtr_dummy_3_ead, CASE WHEN ((((MOD (instrument_retail_derived.mq, 10)) = 4))) THEN (1) ELSE (0) END as qtr_dummy_4_ead, CASE WHEN (((instrument_retail_derived.snap_date_qob <= 8))) THEN (1) ELSE (0) END as age_0_8, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 8) AND (instrument_retail_derived.snap_date_qob <= 16) ) ) THEN (1) ELSE (0) END as age_8_16, CASE WHEN (((instrument_retail_derived.snap_date_qob > 16))) THEN (1) ELSE (0) END as age_16_plus, CASE WHEN ( ( (instrument_retail_derived.date_qss > 0) AND (instrument_retail_derived.date_qss <= 4) ) ) THEN (1) ELSE (0) END as qss_0_4, CASE WHEN ( ( (instrument_retail_derived.date_qss > 4) AND (instrument_retail_derived.date_qss <= 8) ) ) THEN (1) ELSE (0) END as qss_5_8, CASE WHEN ( ( (instrument_retail_derived.date_qss > 8) AND (instrument_retail_derived.date_qss <= 12) ) ) THEN (1) ELSE (0) END as qss_9_12, CASE WHEN (((instrument_retail_derived.date_qss > 12))) THEN (1) ELSE (0) END as qss_13_plus, (instrument_retail_derived.eoq_balance_amt / instrument_retail_derived.original_commitment) as balance_over_financed, CASE WHEN (((instrument_retail_derived.thin_ind = 'N'))) THEN (0) ELSE (1) END as thin_flag, CASE WHEN ((((quarter (instrument_retail_derived.prediction_year)) = 1))) THEN (1) ELSE (0) END as qtr_dummy_1, CASE WHEN ((((quarter (instrument_retail_derived.prediction_year)) = 2))) THEN (1) ELSE (0) END as qtr_dummy_2, CASE WHEN ((((quarter (instrument_retail_derived.prediction_year)) = 3))) THEN (1) ELSE (0) END as qtr_dummy_3, CASE WHEN ((((quarter (instrument_retail_derived.prediction_year)) = 4))) THEN (1) ELSE (0) END as qtr_dummy_4, CASE WHEN (((instrument_retail_derived.date_qob <= 11))) THEN (1) ELSE (0) END as age_0_11, CASE WHEN ( ( (instrument_retail_derived.date_qob > 11) AND (instrument_retail_derived.date_qob <= 19) ) ) THEN (1) ELSE (0) END as age_11_19, CASE WHEN ( ( (instrument_retail_derived.date_qob > 19) AND (instrument_retail_derived.date_qob <= 25) ) ) THEN (1) ELSE (0) END as age_19_25, CASE WHEN (((instrument_retail_derived.date_qob > 25))) THEN (1) ELSE (0) END as age_25_plus, CASE WHEN ( ( (instrument_retail_derived.date_qss > 0) AND (instrument_retail_derived.date_qss <= 13) ) ) THEN (1) ELSE (0) END as mss_0_13, CASE WHEN ( ( (instrument_retail_derived.date_qss > 13) AND (instrument_retail_derived.date_qss <= 24) ) ) THEN (1) ELSE (0) END as mss_14_24, CASE WHEN (((instrument_retail_derived.date_qss > 24))) THEN (1) ELSE (0) END as mss_24_plus, CASE WHEN (((instrument_retail_derived.snap_delq31 = 'Y'))) THEN (1) ELSE (0) END as snap_delq31, CASE WHEN (((instrument_retail_derived.credit_score_orig = null))) THEN (1) ELSE (0) END as missing_fico, instrument_retail_derived.credit_score_orig as credit_score_orig, CASE WHEN ( ( (instrument_retail_derived.date_qob >= 0) AND (instrument_retail_derived.date_qob <= 1) ) ) THEN (1) ELSE (0) END as age0_1_pd2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 1) AND (instrument_retail_derived.date_qob <= 2) ) ) THEN (1) ELSE (0) END as age_2_pd2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 2) AND (instrument_retail_derived.date_qob <= 3) ) ) THEN (1) ELSE (0) END as age_3_pd2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 3) AND (instrument_retail_derived.date_qob <= 4) ) ) THEN (1) ELSE (0) END as age_4_pd2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 4) AND (instrument_retail_derived.date_qob <= 9) ) ) THEN (1) ELSE (0) END as age_5_9_pd2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 9) AND (instrument_retail_derived.date_qob <= 12) ) ) THEN (1) ELSE (0) END as age_10_12_pd2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 12) AND (instrument_retail_derived.date_qob <= 16) ) ) THEN (1) ELSE (0) END as age_13_16_pd2, CASE WHEN (((instrument_retail_derived.date_qss = 2))) THEN (1) ELSE (0) END as qss_2, CASE WHEN (((instrument_retail_derived.date_qss = 3))) THEN (1) ELSE (0) END as qss_3, CASE WHEN (((instrument_retail_derived.date_qss = 4))) THEN (1) ELSE (0) END as qss_4, CASE WHEN (((instrument_retail_derived.date_qss = 5))) THEN (1) ELSE (0) END as qss_5, CASE WHEN (((instrument_retail_derived.date_qss = 6))) THEN (1) ELSE (0) END as qss_6, CASE WHEN (((instrument_retail_derived.date_qss = 7))) THEN (1) ELSE (0) END as qss_7, CASE WHEN (((instrument_retail_derived.date_qss = 8))) THEN (1) ELSE (0) END as qss_8, CASE WHEN (((instrument_retail_derived.date_qss = 9))) THEN (1) ELSE (0) END as qss_9, CASE WHEN (((instrument_retail_derived.date_qss = 10))) THEN (1) ELSE (0) END as qss_10, CASE WHEN (((instrument_retail_derived.date_qss = 11))) THEN (1) ELSE (0) END as qss_11, CASE WHEN (((instrument_retail_derived.date_qss = 12))) THEN (1) ELSE (0) END as qss_12, CASE WHEN (((instrument_retail_derived.snap_segdefault = 2))) THEN ( CASE WHEN ( ( (instrument_retail_derived.snap_tdr = 0) AND (instrument_retail_derived.ltd_extension_cnt = 1) AND (instrument_retail_derived.ltd_extension_nbr >= 1) AND (instrument_retail_derived.ltd_extension_nbr <= 2) ) ) THEN ('A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)') ELSE ('B: All_ELSE') END ) ELSE (null) END as extension_seg2, CASE WHEN (((instrument_retail_derived.snap_segdefault = 3))) THEN ( CASE WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_segdefault = 3))) THEN ( CASE WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc in ('Modification - Bankruptcy', 'Modification - Hardship', 'Modification - Matured', 'Modification - Negotiated Reaff', 'Modification - Negotiated Reaf')) ) ) THEN ('E: TDR Others') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc = 'Modification - TRIPP') ) ) THEN ('A: TDR TRIPP') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 1) ) ) THEN ('B: TDR 1 EXTENSION') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 2) ) ) THEN ('C: TDR 2 EXTENSIONs') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 3) ) ) THEN ('D: TDR 3 or More EXTENSIONs') ELSE ('F: All_ELSE') END ) ELSE (null) END ) = 'A: TDR TRIPP' ) ) ) THEN ('A: TDR TRIPP') WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_segdefault = 3))) THEN ( CASE WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc in ('Modification - Bankruptcy', 'Modification - Hardship', 'Modification - Matured', 'Modification - Negotiated Reaff', 'Modification - Negotiated Reaf')) ) ) THEN ('E: TDR Others') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc = 'Modification - TRIPP') ) ) THEN ('A: TDR TRIPP') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 1) ) ) THEN ('B: TDR 1 EXTENSION') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 2) ) ) THEN ('C: TDR 2 EXTENSIONs') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 3) ) ) THEN ('D: TDR 3 or More EXTENSIONs') ELSE ('F: All_ELSE') END ) ELSE (null) END ) = 'B: TDR 1 EXTENSION' ) ) ) THEN ('B: TDR 1 EXTENSION') WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_segdefault = 3))) THEN ( CASE WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc in ('Modification - Bankruptcy', 'Modification - Hardship', 'Modification - Matured', 'Modification - Negotiated Reaff', 'Modification - Negotiated Reaf')) ) ) THEN ('E: TDR Others') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc = 'Modification - TRIPP') ) ) THEN ('A: TDR TRIPP') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 1) ) ) THEN ('B: TDR 1 EXTENSION') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 2) ) ) THEN ('C: TDR 2 EXTENSIONs') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 3) ) ) THEN ('D: TDR 3 or More EXTENSIONs') ELSE ('F: All_ELSE') END ) ELSE (null) END ) = 'C: TDR 2 EXTENSIONs' ) ) ) THEN ('C: TDR 2 EXTENSIONs') WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_segdefault = 3))) THEN ( CASE WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc in ('Modification - Bankruptcy', 'Modification - Hardship', 'Modification - Matured', 'Modification - Negotiated Reaff', 'Modification - Negotiated Reaf')) ) ) THEN ('E: TDR Others') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc = 'Modification - TRIPP') ) ) THEN ('A: TDR TRIPP') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 1) ) ) THEN ('B: TDR 1 EXTENSION') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 2) ) ) THEN ('C: TDR 2 EXTENSIONs') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 3) ) ) THEN ('D: TDR 3 or More EXTENSIONs') ELSE ('F: All_ELSE') END ) ELSE (null) END ) = 'D: TDR 3 or More EXTENSIONs' ) ) ) THEN ('D: TDR 3 or More EXTENSIONs') ELSE ('E: ALL_ELSE') END ) ELSE (null) END as extension_seg3, CASE WHEN (((instrument_retail_derived.snap_segdefault = 4))) THEN ( CASE WHEN ( ( (instrument_retail_derived.snap_tdr = 0) AND (instrument_retail_derived.ltd_extension_cnt = 1) AND (instrument_retail_derived.ltd_extension_nbr = 1) ) ) THEN ('A: Non-TDR 1 EXTENSION of 1 Month') WHEN ( ( (instrument_retail_derived.snap_tdr = 0) AND (instrument_retail_derived.ltd_extension_cnt = 1) AND (instrument_retail_derived.ltd_extension_nbr = 2) ) ) THEN ('B: Non-TDR 1 EXTENSION of 2 Month') ELSE ('C: All_ELSE') END ) ELSE (null) END as extension_seg4, CASE WHEN (((instrument_retail_derived.snap_segdefault = 3))) THEN ( CASE WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc in ('Modification - Bankruptcy', 'Modification - Hardship', 'Modification - Matured', 'Modification - Negotiated Reaff', 'Modification - Negotiated Reaf')) ) ) THEN ('E: TDR Others') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.scusa_first_tdr_reason_desc = 'Modification - TRIPP') ) ) THEN ('A: TDR TRIPP') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 1) ) ) THEN ('B: TDR 1 EXTENSION') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 2) ) ) THEN ('C: TDR 2 EXTENSIONs') WHEN ( ( (instrument_retail_derived.snap_tdr = 1) AND (instrument_retail_derived.ltd_extension_cnt = 3) ) ) THEN ('D: TDR 3 or More EXTENSIONs') ELSE ('F: All_ELSE') END ) ELSE (null) END as extension_v1, CASE WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_dpd < 0))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_dpd > 0) AND (instrument_retail_derived.snap_dpd <= 30) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_dpd > 30) AND (instrument_retail_derived.snap_dpd <= 60) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_dpd > 60) AND (instrument_retail_derived.snap_dpd <= 90) ) ) THEN (4) WHEN (((instrument_retail_derived.snap_dpd > 90))) THEN (5) ELSE (1) END ) = 3 ) AND (instrument_retail_derived.date_qss = 1) ) ) THEN ('A: DPD 31 to 60 at QSS = 1') WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_dpd < 0))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_dpd > 0) AND (instrument_retail_derived.snap_dpd <= 30) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_dpd > 30) AND (instrument_retail_derived.snap_dpd <= 60) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_dpd > 60) AND (instrument_retail_derived.snap_dpd <= 90) ) ) THEN (4) WHEN (((instrument_retail_derived.snap_dpd > 90))) THEN (5) ELSE (1) END ) = 3 ) AND (instrument_retail_derived.date_qss = 2) ) ) THEN ('B: DPD 31 to 60 at QSS = 2') WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_dpd < 0))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_dpd > 0) AND (instrument_retail_derived.snap_dpd <= 30) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_dpd > 30) AND (instrument_retail_derived.snap_dpd <= 60) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_dpd > 60) AND (instrument_retail_derived.snap_dpd <= 90) ) ) THEN (4) WHEN (((instrument_retail_derived.snap_dpd > 90))) THEN (5) ELSE (1) END ) = 2 ) AND (instrument_retail_derived.date_qss < 3) ) ) THEN ('C: DPD 1 to 30 at QSS = 1 or 2') ELSE ('D: Others') END as inter_dpd_qss2, CASE WHEN ((((UPPER(instrument_retail_derived.new_used)) = 'U'))) THEN (1) WHEN ((((UPPER(instrument_retail_derived.new_used)) = 'N'))) THEN (0) ELSE (null) END as used, CASE WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 8) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.pti_pct >= 8) AND (instrument_retail_derived.pti_pct < 9) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.pti_pct >= 9) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.pti_pct >= 10) AND (instrument_retail_derived.pti_pct < 11) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.pti_pct >= 11) AND (instrument_retail_derived.pti_pct < 12) ) ) THEN (6) ELSE (7) END ) = 1 ) ) ) THEN (1) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 8) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.pti_pct >= 8) AND (instrument_retail_derived.pti_pct < 9) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.pti_pct >= 9) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.pti_pct >= 10) AND (instrument_retail_derived.pti_pct < 11) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.pti_pct >= 11) AND (instrument_retail_derived.pti_pct < 12) ) ) THEN (6) ELSE (7) END ) >= 2 ) AND ( ( CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 8) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.pti_pct >= 8) AND (instrument_retail_derived.pti_pct < 9) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.pti_pct >= 9) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.pti_pct >= 10) AND (instrument_retail_derived.pti_pct < 11) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.pti_pct >= 11) AND (instrument_retail_derived.pti_pct < 12) ) ) THEN (6) ELSE (7) END ) <= 3 ) ) ) THEN (2) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 8) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.pti_pct >= 8) AND (instrument_retail_derived.pti_pct < 9) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.pti_pct >= 9) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.pti_pct >= 10) AND (instrument_retail_derived.pti_pct < 11) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.pti_pct >= 11) AND (instrument_retail_derived.pti_pct < 12) ) ) THEN (6) ELSE (7) END ) = 4 ) ) ) THEN (3) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 8) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.pti_pct >= 8) AND (instrument_retail_derived.pti_pct < 9) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.pti_pct >= 9) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.pti_pct >= 10) AND (instrument_retail_derived.pti_pct < 11) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.pti_pct >= 11) AND (instrument_retail_derived.pti_pct < 12) ) ) THEN (6) ELSE (7) END ) >= 5 ) AND ( ( CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 8) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.pti_pct >= 8) AND (instrument_retail_derived.pti_pct < 9) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.pti_pct >= 9) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.pti_pct >= 10) AND (instrument_retail_derived.pti_pct < 11) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.pti_pct >= 11) AND (instrument_retail_derived.pti_pct < 12) ) ) THEN (6) ELSE (7) END ) <= 6 ) ) ) THEN (4) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 8) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.pti_pct >= 8) AND (instrument_retail_derived.pti_pct < 9) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.pti_pct >= 9) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.pti_pct >= 10) AND (instrument_retail_derived.pti_pct < 11) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.pti_pct >= 11) AND (instrument_retail_derived.pti_pct < 12) ) ) THEN (6) ELSE (7) END ) = 7 ) ) ) THEN (5) END as bin_snap_pti_f_pd3, CASE WHEN (((instrument_retail_derived.pti_pct = null))) THEN (1) WHEN ( ( (instrument_retail_derived.pti_pct > 0) AND (instrument_retail_derived.pti_pct < 10) ) ) THEN (2) ELSE (3) END as bin_snap_pti_f_2, CASE WHEN (((instrument_retail_derived.snap_date_qob <= 1))) THEN (1) ELSE (0) END as qob_ead_le1, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 1) AND (instrument_retail_derived.snap_date_qob <= 3) ) ) THEN (1) ELSE (0) END as qob_ead_2_3, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 3) AND (instrument_retail_derived.snap_date_qob <= 5) ) ) THEN (1) ELSE (0) END as qob_ead_4_5, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 5) AND (instrument_retail_derived.snap_date_qob <= 7) ) ) THEN (1) ELSE (0) END as qob_ead_6_7, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 7) AND (instrument_retail_derived.snap_date_qob <= 9) ) ) THEN (1) ELSE (0) END as qob_ead_8_9, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 9) AND (instrument_retail_derived.snap_date_qob <= 11) ) ) THEN (1) ELSE (0) END as qob_ead_10_11, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 11) AND (instrument_retail_derived.snap_date_qob <= 15) ) ) THEN (1) ELSE (0) END as qob_ead_12_15, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 15) AND (instrument_retail_derived.snap_date_qob <= 17) ) ) THEN (1) ELSE (0) END as qob_ead_16_17, CASE WHEN ( ( (instrument_retail_derived.snap_date_qob > 17) AND (instrument_retail_derived.snap_date_qob <= 19) ) ) THEN (1) ELSE (0) END as qob_ead_18_19, CASE WHEN (((instrument_retail_derived.snap_date_qob > 19))) THEN (1) ELSE (0) END as qob_ead_ge20, CASE WHEN (((instrument_retail_derived.date_qss <= 1))) THEN (1) ELSE (0) END as qss_ead_1, CASE WHEN ( ( (instrument_retail_derived.date_qss > 1) AND (instrument_retail_derived.date_qss <= 3) ) ) THEN (1) ELSE (0) END as qss_ead_2_3, CASE WHEN ( ( (instrument_retail_derived.date_qss > 3) AND (instrument_retail_derived.date_qss <= 5) ) ) THEN (1) ELSE (0) END as qss_ead_4_5, CASE WHEN ( ( (instrument_retail_derived.date_qss > 5) AND (instrument_retail_derived.date_qss <= 7) ) ) THEN (1) ELSE (0) END as qss_ead_6_7, CASE WHEN ( ( (instrument_retail_derived.date_qss > 7) AND (instrument_retail_derived.date_qss <= 9) ) ) THEN (1) ELSE (0) END as qss_ead_8_9, CASE WHEN ( ( (instrument_retail_derived.date_qss > 9) AND (instrument_retail_derived.date_qss <= 11) ) ) THEN (1) ELSE (0) END as qss_ead_10_11, CASE WHEN ( ( (instrument_retail_derived.date_qss > 11) AND (instrument_retail_derived.date_qss <= 13) ) ) THEN (1) ELSE (0) END as qss_ead_12_13, CASE WHEN (((instrument_retail_derived.date_qss > 13))) THEN (1) ELSE (0) END as qss_ead_ge14, CASE WHEN (((instrument_retail_derived.date_qob <= 2))) THEN (1) ELSE (0) END as pymt_age_le2, CASE WHEN ( ( (instrument_retail_derived.date_qob > 2) AND (instrument_retail_derived.date_qob <= 4) ) ) THEN (1) ELSE (0) END as pymt_age_3_4, CASE WHEN ( ( (instrument_retail_derived.date_qob > 4) AND (instrument_retail_derived.date_qob <= 7) ) ) THEN (1) ELSE (0) END as pymt_age_5_7, CASE WHEN ( ( (instrument_retail_derived.date_qob > 7) AND (instrument_retail_derived.date_qob <= 11) ) ) THEN (1) ELSE (0) END as pymt_age_8_11, CASE WHEN ( ( (instrument_retail_derived.date_qob > 11) AND (instrument_retail_derived.date_qob <= 12) ) ) THEN (1) ELSE (0) END as pymt_age_12_12, CASE WHEN ( ( (instrument_retail_derived.date_qob > 12) AND (instrument_retail_derived.date_qob <= 15) ) ) THEN (1) ELSE (0) END as pymt_age_13_15, CASE WHEN ( ( (instrument_retail_derived.date_qob > 15) AND (instrument_retail_derived.date_qob <= 17) ) ) THEN (1) ELSE (0) END as pymt_age_16_17, CASE WHEN ( ( (instrument_retail_derived.date_qob > 17) AND (instrument_retail_derived.date_qob <= 19) ) ) THEN (1) ELSE (0) END as pymt_age_18_19, CASE WHEN (((instrument_retail_derived.date_qob > 19))) THEN (1) ELSE (0) END as pymt_age_ge_20, CASE WHEN (((instrument_retail_derived.date_qss <= 1))) THEN (1) ELSE (0) END as pymt_qss_1_1, CASE WHEN ( ( (instrument_retail_derived.date_qss > 1) AND (instrument_retail_derived.date_qss <= 2) ) ) THEN (1) ELSE (0) END as pymt_qss_2_2, CASE WHEN ( ( (instrument_retail_derived.date_qss > 2) AND (instrument_retail_derived.date_qss <= 4) ) ) THEN (1) ELSE (0) END as pymt_qss_3_4, CASE WHEN ( ( (instrument_retail_derived.date_qss > 4) AND (instrument_retail_derived.date_qss <= 6) ) ) THEN (1) ELSE (0) END as pymt_qss_5_6, CASE WHEN ( ( (instrument_retail_derived.date_qss > 6) AND (instrument_retail_derived.date_qss <= 8) ) ) THEN (1) ELSE (0) END as pymt_qss_7_8, CASE WHEN ( ( (instrument_retail_derived.date_qss > 8) AND (instrument_retail_derived.date_qss <= 10) ) ) THEN (1) ELSE (0) END as pymt_qss_9_10, CASE WHEN ( ( (instrument_retail_derived.date_qss > 10) AND (instrument_retail_derived.date_qss <= 11) ) ) THEN (1) ELSE (0) END as pymt_qss_11_11, CASE WHEN ( ( (instrument_retail_derived.date_qss > 11) AND (instrument_retail_derived.date_qss <= 13) ) ) THEN (1) ELSE (0) END as pymt_qss_12_13, CASE WHEN (((instrument_retail_derived.date_qss > 13))) THEN (1) ELSE (0) END as pymt_qss_ge_14, CASE WHEN ( ( (instrument_retail_derived.snap_lfs < 250) OR (instrument_retail_derived.snap_lfs > 900) ) ) THEN (1) ELSE (0) END as lfs_missing, CASE WHEN (((instrument_retail_derived.snap_lfs <= 500))) THEN (1) ELSE (0) END as lfs_le_500, CASE WHEN ( ( (instrument_retail_derived.snap_lfs > 500) AND (instrument_retail_derived.snap_lfs <= 550) ) ) THEN (1) ELSE (0) END as lfs_501_550, CASE WHEN ( ( (instrument_retail_derived.snap_lfs > 550) AND (instrument_retail_derived.snap_lfs <= 600) ) ) THEN (1) ELSE (0) END as lfs_551_600, CASE WHEN ( ( (instrument_retail_derived.snap_lfs > 600) AND (instrument_retail_derived.snap_lfs <= 650) ) ) THEN (1) ELSE (0) END as lfs_601_650, CASE WHEN ( ( (instrument_retail_derived.snap_lfs > 650) AND (instrument_retail_derived.snap_lfs <= 700) ) ) THEN (1) ELSE (0) END as lfs_651_700, CASE WHEN ( ( (instrument_retail_derived.snap_lfs > 700) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (1) ELSE (0) END as lfs_701_900, CASE WHEN (((instrument_retail_derived.snap_dpd <= 0))) THEN (1) ELSE (0) END as dpd_le_zero, CASE WHEN ( ( (instrument_retail_derived.snap_dpd > 0) AND (instrument_retail_derived.snap_dpd <= 30) ) ) THEN (1) ELSE (0) END as dpd_1_30, CASE WHEN (((instrument_retail_derived.snap_dpd > 30))) THEN (1) ELSE (0) END as dpd_ge_31, CASE WHEN (((instrument_retail_derived.date_qss <= 1))) THEN (1) ELSE (0) END as qss_lgd_1, CASE WHEN ( ( (instrument_retail_derived.date_qss > 1) AND (instrument_retail_derived.date_qss <= 2) ) ) THEN (1) ELSE (0) END as qss_lgd_2, CASE WHEN ( ( (instrument_retail_derived.date_qss > 2) AND (instrument_retail_derived.date_qss <= 4) ) ) THEN (1) ELSE (0) END as qss_lgd_3_4, CASE WHEN ( ( (instrument_retail_derived.date_qss > 4) AND (instrument_retail_derived.date_qss <= 6) ) ) THEN (1) ELSE (0) END as qss_lgd_5_6, CASE WHEN ( ( (instrument_retail_derived.date_qss > 6) AND (instrument_retail_derived.date_qss <= 8) ) ) THEN (1) ELSE (0) END as qss_lgd_7_8, CASE WHEN ( ( (instrument_retail_derived.date_qss > 8) AND (instrument_retail_derived.date_qss <= 10) ) ) THEN (1) ELSE (0) END as qss_lgd_9_10, CASE WHEN ( ( (instrument_retail_derived.date_qss > 10) AND (instrument_retail_derived.date_qss <= 12) ) ) THEN (1) ELSE (0) END as qss_lgd_11_12, CASE WHEN ( ( (instrument_retail_derived.date_qss > 12) AND (instrument_retail_derived.date_qss <= 14) ) ) THEN (1) ELSE (0) END as qss_lgd_13_14, CASE WHEN (((instrument_retail_derived.date_qss > 14))) THEN (1) ELSE (0) END as qss_lgd_15, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Intermediate Mid-Size'))) THEN (1) ELSE (0) END as intermediate_mid_size, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Intermediate Compact'))) THEN (1) ELSE (0) END as intermediate_compact, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Pickup'))) THEN (1) ELSE (0) END as large_pickup, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Mid-Size Utility'))) THEN (1) ELSE (0) END as mid_size_utility, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Compact Utility'))) THEN (1) ELSE (0) END as compact_utility, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large Car'))) THEN (1) ELSE (0) END as large_car, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Mid-Size Van'))) THEN (1) ELSE (0) END as mid_size_van, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Intermediate Subcompact'))) THEN (1) ELSE (0) END as intermediate_subcompact, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Near Luxury'))) THEN (1) ELSE (0) END as near_luxury, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Large SUV'))) THEN (1) ELSE (0) END as large_suv, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Sport'))) THEN (1) ELSE (0) END as sport, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Mid-Size Pickup'))) THEN (1) ELSE (0) END as mid_size_pickup, CASE WHEN (((instrument_detail_retail.nada_vehicle_segment_desc = 'Upper Sport'))) THEN (1) ELSE (0) END as upper_sport, CASE WHEN ( ( ((instr(instrument_detail_retail.nada_vehicle_segment_desc, 'Luxury')) = 1) OR ((instr(instrument_detail_retail.nada_vehicle_segment_desc, 'Premium Luxury')) = 1) ) ) THEN (1) ELSE (0) END as vehicle_luxury, CASE WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 1 ) ) ) THEN (1) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 2 ) ) ) THEN (2) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 3 ) ) ) THEN (3) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 4 ) ) ) THEN (4) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 5 ) ) ) THEN (5) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) in (6, 7) ) ) ) THEN (6) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 8 ) ) ) THEN (7) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 9 ) ) ) THEN (8) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 10 ) ) ) THEN (9) WHEN ( ( ( ( CASE WHEN (((instrument_retail_derived.snap_lfs = null))) THEN (1) WHEN ( ( (instrument_retail_derived.snap_lfs >= 250) AND (instrument_retail_derived.snap_lfs < 476) ) ) THEN (2) WHEN ( ( (instrument_retail_derived.snap_lfs >= 476) AND (instrument_retail_derived.snap_lfs < 506) ) ) THEN (3) WHEN ( ( (instrument_retail_derived.snap_lfs >= 506) AND (instrument_retail_derived.snap_lfs < 529) ) ) THEN (4) WHEN ( ( (instrument_retail_derived.snap_lfs >= 529) AND (instrument_retail_derived.snap_lfs < 548) ) ) THEN (5) WHEN ( ( (instrument_retail_derived.snap_lfs >= 548) AND (instrument_retail_derived.snap_lfs < 567) ) ) THEN (6) WHEN ( ( (instrument_retail_derived.snap_lfs >= 567) AND (instrument_retail_derived.snap_lfs < 586) ) ) THEN (7) WHEN ( ( (instrument_retail_derived.snap_lfs >= 586) AND (instrument_retail_derived.snap_lfs < 607) ) ) THEN (8) WHEN ( ( (instrument_retail_derived.snap_lfs >= 607) AND (instrument_retail_derived.snap_lfs < 632) ) ) THEN (9) WHEN ( ( (instrument_retail_derived.snap_lfs >= 632) AND (instrument_retail_derived.snap_lfs < 668) ) ) THEN (10) WHEN ( ( (instrument_retail_derived.snap_lfs >= 668) AND (instrument_retail_derived.snap_lfs <= 900) ) ) THEN (11) ELSE (1) END ) = 11 ) ) ) THEN (10) END as bin_snap_fico_f_pd3, 1743661746824 as version, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Van'))) THEN (1) ELSE (0) END as van, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Compact Car'))) THEN (1) ELSE (0) END as compact_car, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Compact/Midsize Pickup'))) THEN (1) ELSE (0) END as compact_midsize_pickup, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Small SUV'))) THEN (1) ELSE (0) END as small_suv, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Mid Size Car'))) THEN (1) ELSE (0) END as mid_size_car, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Mid Size SUV'))) THEN (1) ELSE (0) END as mid_size_suv, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Sports Car'))) THEN (1) ELSE (0) END as sports_car, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Luxury'))) THEN (1) ELSE (0) END as luxury, CASE WHEN (((instrument_retail_derived.vehicle_model_segment in ('Large SUV', 'Large Car', 'Large Pickup')))) THEN (1) ELSE (0) END as large_size_vehicle, CASE WHEN (((instrument_retail_derived.vehicle_model_segment in ('Mid Size Car', 'Mid Size SUV')))) THEN (1) ELSE (0) END as mid_size_vehicle, CASE WHEN (((instrument_retail_derived.vehicle_model_segment in ('Compact Car', 'Small SUV')))) THEN (1) ELSE (0) END as compact_size_vehicle, CASE WHEN (((instrument_retail_derived.vehicle_model_segment in ('Large SUV', 'Large Pickup', 'Mid Size SUV')))) THEN (1) ELSE (0) END as truck, CASE WHEN (((instrument_retail_derived.vehicle_model_segment in ('Large Car', 'Mid Size Car')))) THEN (1) ELSE (0) END as large_mid_car, CASE WHEN (((instrument_retail_derived.vehicle_model_segment in ('Large SUV', 'Mid Size SUV')))) THEN (1) ELSE (0) END as large_mid_suv, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Large Car'))) THEN (1) ELSE (0) END as large_car_rc, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Large Pickup'))) THEN (1) ELSE (0) END as large_pickup_rc, CASE WHEN (((instrument_retail_derived.vehicle_model_segment = 'Large SUV'))) THEN (1) ELSE (0) END as large_suv_rc FROM instrument_auto_derived_map as instrument_retail_derived JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = instrument_retail_derived.reporting_date)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((instrument_retail_derived.instrument_id = instrument_detail_retail.loan_key)) WHERE (1 = 1) """
___________________________________
STAGE 1 - Model Name :  Retail Secured PD
# TASK 0
Task Desc : Compute PD Loanwise
Target Map name : retail_pd_map
Target Table name : retail_pd
SQL : """SELECT retail_model_variables.reporting_date as reporting_date, retail_model_variables.prediction_year as prediction_year, retail_model_variables.instrument_id as instrument_id, portfolio.id as portfolio_id, scenario.scenario_id as scenario_id, region.id as region_id, CASE WHEN (model_segment.code = 'SEG1') THEN ( EXP( ( -3.440275334 + 1.222759463 * retail_model_variables.age0_1_f + 0.983874938 * retail_model_variables.age2_3_f + 0.473621911 * retail_model_variables.age4_9_f + 0.254329928 * retail_model_variables.age10_12_f + 0.202608179 * retail_model_variables.age13_16_f + 1.868015903 * retail_model_variables.qss0_1_f + 0.484525624 * retail_model_variables.qss2_3_f + 0.144559469 * retail_model_variables.qss4_9_f + 0.021005396 * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + -0.267632725 * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + -0.181943719 * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + -0.12392427 * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + -0.060180786 * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + -0.953477025 * (IF (retail_model_variables.bin_snapDPD_f = 4, 1, 0)) + -0.05762538 * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0.246968935 * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0.001303827 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + -0.005070554 * macro_economic_factors_national_derived.6m_Manheim_gr + -0.001598626 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + -0.161376381 * retail_model_variables.qtr1 + -0.193538878 * retail_model_variables.qtr2 + 0.006141058 * retail_model_variables.qtr3 + 0d + 0d * retail_model_variables.age0_1_pd2 + 0d * retail_model_variables.age_2_pd2 + 0d * retail_model_variables.age_3_pd2 + 0d * retail_model_variables.age_4_pd2 + 0d * retail_model_variables.age_5_9_pd2 + 0d * retail_model_variables.age_10_12_pd2 + 0d * retail_model_variables.age_13_16_pd2 + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss_2 + 0d * retail_model_variables.qss_3 + 0d * retail_model_variables.qss_4 + 0d * retail_model_variables.qss_5 + 0d * retail_model_variables.qss_6 + 0d * retail_model_variables.qss_7 + 0d * retail_model_variables.qss_8 + 0d * retail_model_variables.qss_9 + 0d * retail_model_variables.qss_10 + 0d * retail_model_variables.qss_11 + 0d * retail_model_variables.qss_12 + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 IN (2, 3), 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_oltv_f_3 IN (2, 3), 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 4, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_fico_f_pd3 IN (5, 6), 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.serviced + 0d * retail_model_variables.used + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg3 = 'A: TDR TRIPP', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'B: TDR 1 EXTENSION', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'C: TDR 2 EXTENSIONs', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'D: TDR 3 or More EXTENSIONs', 1, 0)) + 0d * ( if ( retail_model_variables.bin_snapDPD_f = 3 AND retail_model_variables.date_qss = 1, 1, 0 ) ) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.used + 0d * retail_model_variables.serviced + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) ) ) / ( 1 + EXP( ( -3.440275334 + 1.222759463 * retail_model_variables.age0_1_f + 0.983874938 * retail_model_variables.age2_3_f + 0.473621911 * retail_model_variables.age4_9_f + 0.254329928 * retail_model_variables.age10_12_f + 0.202608179 * retail_model_variables.age13_16_f + 1.868015903 * retail_model_variables.qss0_1_f + 0.484525624 * retail_model_variables.qss2_3_f + 0.144559469 * retail_model_variables.qss4_9_f + 0.021005396 * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + -0.267632725 * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + -0.181943719 * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + -0.12392427 * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + -0.060180786 * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + -0.953477025 * (IF (retail_model_variables.bin_snapDPD_f = 4, 1, 0)) + -0.05762538 * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0.246968935 * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0.001303827 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + -0.005070554 * macro_economic_factors_national_derived.6m_Manheim_gr + -0.001598626 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + -0.161376381 * retail_model_variables.qtr1 + -0.193538878 * retail_model_variables.qtr2 + 0.006141058 * retail_model_variables.qtr3 + 0d + 0d * retail_model_variables.age0_1_pd2 + 0d * retail_model_variables.age_2_pd2 + 0d * retail_model_variables.age_3_pd2 + 0d * retail_model_variables.age_4_pd2 + 0d * retail_model_variables.age_5_9_pd2 + 0d * retail_model_variables.age_10_12_pd2 + 0d * retail_model_variables.age_13_16_pd2 + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss_2 + 0d * retail_model_variables.qss_3 + 0d * retail_model_variables.qss_4 + 0d * retail_model_variables.qss_5 + 0d * retail_model_variables.qss_6 + 0d * retail_model_variables.qss_7 + 0d * retail_model_variables.qss_8 + 0d * retail_model_variables.qss_9 + 0d * retail_model_variables.qss_10 + 0d * retail_model_variables.qss_11 + 0d * retail_model_variables.qss_12 + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 IN (2, 3), 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_oltv_f_3 IN (2, 3), 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 4, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_fico_f_pd3 IN (5, 6), 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.serviced + 0d * retail_model_variables.used + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg3 = 'A: TDR TRIPP', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'B: TDR 1 EXTENSION', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'C: TDR 2 EXTENSIONs', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'D: TDR 3 or More EXTENSIONs', 1, 0)) + 0d * ( if ( retail_model_variables.bin_snapDPD_f = 3 AND retail_model_variables.date_qss = 1, 1, 0 ) ) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.used + 0d * retail_model_variables.serviced + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) ) ) ) ) WHEN (model_segment.code = 'SEG2') THEN ( EXP( ( 0d + 0d * retail_model_variables.age0_1_f + 0d * retail_model_variables.age2_3_f + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * macro_economic_factors_national_derived.6m_Manheim_gr + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + -3.666495664 + 1.581973288 * retail_model_variables.age0_1_pd2 + 1.240549527 * retail_model_variables.age_2_pd2 + 0.752955103 * retail_model_variables.age_3_pd2 + 0.746442564 * retail_model_variables.age_4_pd2 + 0.573310498 * retail_model_variables.age_5_9_pd2 + 0.377274958 * retail_model_variables.age_10_12_pd2 + 0.16455609 * retail_model_variables.age_13_16_pd2 + -3.286530557 * retail_model_variables.qss0_1_f + -1.480521713 * retail_model_variables.qss_2 + -0.793803459 * retail_model_variables.qss_3 + -0.641985497 * retail_model_variables.qss_4 + -0.555593848 * retail_model_variables.qss_5 + -0.494992201 * retail_model_variables.qss_6 + -0.472401857 * retail_model_variables.qss_7 + -0.415535381 * retail_model_variables.qss_8 + -0.321392866 * retail_model_variables.qss_9 + -0.244395411 * retail_model_variables.qss_10 + -0.199429745 * retail_model_variables.qss_11 + -0.146272188 * retail_model_variables.qss_12 + -0.075437153 * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + -0.404129505 * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + -0.221702377 * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + -0.182900294 * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + -0.142522718 * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + -0.086105297 * (IF (retail_model_variables.bin_pti_f = 6, 1, 0)) + 0.156208728 * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + -0.515488847 * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + -0.305259795 * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + -0.170347716 * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + -0.060369803 * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0.789243848 * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0.839407561 * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0.746412146 * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0.68689265 * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0.628208089 * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0.613476147 * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0.550098892 * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0.42424474 * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0.332638334 * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0.21232835 * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0.111312236 * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0.08871905 * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + -0.959990762 * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + -0.4131709 * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + -0.378652801 * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0.346320908 * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0.004854341 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + -0.087496516 * retail_model_variables.qtr1 + -0.283862874 * retail_model_variables.qtr2 + -0.053878184 * retail_model_variables.qtr3 + 0.817948272 * (IF (retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)', 1, 0)) + 2.715181395 * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0.946165876 * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0.772700524 * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 IN (2, 3), 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_oltv_f_3 IN (2, 3), 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 4, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_fico_f_pd3 IN (5, 6), 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.serviced + 0d * retail_model_variables.used + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg3 = 'A: TDR TRIPP', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'B: TDR 1 EXTENSION', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'C: TDR 2 EXTENSIONs', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'D: TDR 3 or More EXTENSIONs', 1, 0)) + 0d * ( if ( retail_model_variables.bin_snapDPD_f = 3 AND retail_model_variables.date_qss = 1, 1, 0 ) ) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.used + 0d * retail_model_variables.serviced + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) ) ) / ( 1 + EXP( ( 0d + 0d * retail_model_variables.age0_1_f + 0d * retail_model_variables.age2_3_f + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * macro_economic_factors_national_derived.6m_Manheim_gr + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + -3.666495664 + 1.581973288 * retail_model_variables.age0_1_pd2 + 1.240549527 * retail_model_variables.age_2_pd2 + 0.752955103 * retail_model_variables.age_3_pd2 + 0.746442564 * retail_model_variables.age_4_pd2 + 0.573310498 * retail_model_variables.age_5_9_pd2 + 0.377274958 * retail_model_variables.age_10_12_pd2 + 0.16455609 * retail_model_variables.age_13_16_pd2 + -3.286530557 * retail_model_variables.qss0_1_f + -1.480521713 * retail_model_variables.qss_2 + -0.793803459 * retail_model_variables.qss_3 + -0.641985497 * retail_model_variables.qss_4 + -0.555593848 * retail_model_variables.qss_5 + -0.494992201 * retail_model_variables.qss_6 + -0.472401857 * retail_model_variables.qss_7 + -0.415535381 * retail_model_variables.qss_8 + -0.321392866 * retail_model_variables.qss_9 + -0.244395411 * retail_model_variables.qss_10 + -0.199429745 * retail_model_variables.qss_11 + -0.146272188 * retail_model_variables.qss_12 + -0.075437153 * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + -0.404129505 * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + -0.221702377 * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + -0.182900294 * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + -0.142522718 * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + -0.086105297 * (IF (retail_model_variables.bin_pti_f = 6, 1, 0)) + 0.156208728 * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + -0.515488847 * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + -0.305259795 * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + -0.170347716 * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + -0.060369803 * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0.789243848 * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0.839407561 * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0.746412146 * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0.68689265 * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0.628208089 * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0.613476147 * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0.550098892 * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0.42424474 * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0.332638334 * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0.21232835 * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0.111312236 * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0.08871905 * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + -0.959990762 * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + -0.4131709 * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + -0.378652801 * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0.346320908 * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0.004854341 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + -0.087496516 * retail_model_variables.qtr1 + -0.283862874 * retail_model_variables.qtr2 + -0.053878184 * retail_model_variables.qtr3 + 0.817948272 * (IF (retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)', 1, 0)) + 2.715181395 * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0.946165876 * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0.772700524 * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 IN (2, 3), 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_oltv_f_3 IN (2, 3), 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 4, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_fico_f_pd3 IN (5, 6), 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.serviced + 0d * retail_model_variables.used + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg3 = 'A: TDR TRIPP', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'B: TDR 1 EXTENSION', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'C: TDR 2 EXTENSIONs', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'D: TDR 3 or More EXTENSIONs', 1, 0)) + 0d * ( if ( retail_model_variables.bin_snapDPD_f = 3 AND retail_model_variables.date_qss = 1, 1, 0 ) ) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.used + 0d * retail_model_variables.serviced + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) ) ) ) ) WHEN (model_segment.code = 'SEG3') THEN ( EXP( ( 0d + 0d * retail_model_variables.age0_1_f + 0d * retail_model_variables.age2_3_f + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * macro_economic_factors_national_derived.6m_Manheim_gr + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d + 0d * retail_model_variables.age0_1_pd2 + 0d * retail_model_variables.age_2_pd2 + 0d * retail_model_variables.age_3_pd2 + 0d * retail_model_variables.age_4_pd2 + 0d * retail_model_variables.age_5_9_pd2 + 0d * retail_model_variables.age_10_12_pd2 + 0d * retail_model_variables.age_13_16_pd2 + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss_2 + 0d * retail_model_variables.qss_3 + 0d * retail_model_variables.qss_4 + 0d * retail_model_variables.qss_5 + 0d * retail_model_variables.qss_6 + 0d * retail_model_variables.qss_7 + 0d * retail_model_variables.qss_8 + 0d * retail_model_variables.qss_9 + 0d * retail_model_variables.qss_10 + 0d * retail_model_variables.qss_11 + 0d * retail_model_variables.qss_12 + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) + -2.097316556 + 0.752271731 * retail_model_variables.age4_9_f + 0.366545675 * retail_model_variables.age10_12_f + 0.182312159 * retail_model_variables.age13_16_f + -1.909915825 * retail_model_variables.qss0_1_f + -0.274718027 * retail_model_variables.qss2_3_f + -0.159370808 * retail_model_variables.qss4_9_f + -0.058465192 * retail_model_variables.qss10_12_f + -0.03438495 * (if (retail_model_variables.bin_snap_pti_f_pd3 = 1, 1, 0)) + -0.119920077 * (if (retail_model_variables.bin_snap_pti_f_pd3 IN (2, 3), 1, 0)) + -0.033938419 * (if (retail_model_variables.bin_snap_pti_f_pd3 = 4, 1, 0)) + 0.154846517 * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + -0.151645856 * (if (retail_model_variables.bin_oltv_f_3 IN (2, 3), 1, 0)) + -0.084258222 * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + -0.026435771 * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0.613732329 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 1, 1, 0)) + 0.52410985 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 2, 1, 0)) + 0.497828895 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 3, 1, 0)) + 0.427529928 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 4, 1, 0)) + 0.389613055 * (if (retail_model_variables.bin_snap_fico_f_pd3 IN (5, 6), 1, 0)) + 0.349066318 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 7, 1, 0)) + 0.304090716 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 8, 1, 0)) + 0.151240907 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 9, 1, 0)) + -0.078727359 * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0.184646202 * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0.16639535 * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + -0.613109813 * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + -0.232767584 * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + -0.159075767 * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0.22192189 * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + -0.764021869 * retail_model_variables.serviced + 0.070980927 * retail_model_variables.used + 0.001946638 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + -0.01037415 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + -0.094285971 * retail_model_variables.qtr1 + -0.241255168 * retail_model_variables.qtr2 + -0.044815803 * retail_model_variables.qtr3 + -0.601467369 * (IF (retail_model_variables.extension_seg3 = 'A: TDR TRIPP', 1, 0)) + -0.532247723 * (IF (retail_model_variables.extension_seg3 = 'B: TDR 1 EXTENSION', 1, 0)) + -0.502170384 * (IF (retail_model_variables.extension_seg3 = 'C: TDR 2 EXTENSIONs', 1, 0)) + -0.323407632 * (IF (retail_model_variables.extension_seg3 = 'D: TDR 3 or More EXTENSIONs', 1, 0)) + 1.72250853 * ( if ( retail_model_variables.bin_snapDPD_f = 3 AND retail_model_variables.date_qss = 1, 1, 0 ) ) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.used + 0d * retail_model_variables.serviced + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) ) ) / ( 1 + EXP( ( 0d + 0d * retail_model_variables.age0_1_f + 0d * retail_model_variables.age2_3_f + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * macro_economic_factors_national_derived.6m_Manheim_gr + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d + 0d * retail_model_variables.age0_1_pd2 + 0d * retail_model_variables.age_2_pd2 + 0d * retail_model_variables.age_3_pd2 + 0d * retail_model_variables.age_4_pd2 + 0d * retail_model_variables.age_5_9_pd2 + 0d * retail_model_variables.age_10_12_pd2 + 0d * retail_model_variables.age_13_16_pd2 + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss_2 + 0d * retail_model_variables.qss_3 + 0d * retail_model_variables.qss_4 + 0d * retail_model_variables.qss_5 + 0d * retail_model_variables.qss_6 + 0d * retail_model_variables.qss_7 + 0d * retail_model_variables.qss_8 + 0d * retail_model_variables.qss_9 + 0d * retail_model_variables.qss_10 + 0d * retail_model_variables.qss_11 + 0d * retail_model_variables.qss_12 + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) + -2.097316556 + 0.752271731 * retail_model_variables.age4_9_f + 0.366545675 * retail_model_variables.age10_12_f + 0.182312159 * retail_model_variables.age13_16_f + -1.909915825 * retail_model_variables.qss0_1_f + -0.274718027 * retail_model_variables.qss2_3_f + -0.159370808 * retail_model_variables.qss4_9_f + -0.058465192 * retail_model_variables.qss10_12_f + -0.03438495 * (if (retail_model_variables.bin_snap_pti_f_pd3 = 1, 1, 0)) + -0.119920077 * (if (retail_model_variables.bin_snap_pti_f_pd3 IN (2, 3), 1, 0)) + -0.033938419 * (if (retail_model_variables.bin_snap_pti_f_pd3 = 4, 1, 0)) + 0.154846517 * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + -0.151645856 * (if (retail_model_variables.bin_oltv_f_3 IN (2, 3), 1, 0)) + -0.084258222 * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + -0.026435771 * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0.613732329 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 1, 1, 0)) + 0.52410985 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 2, 1, 0)) + 0.497828895 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 3, 1, 0)) + 0.427529928 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 4, 1, 0)) + 0.389613055 * (if (retail_model_variables.bin_snap_fico_f_pd3 IN (5, 6), 1, 0)) + 0.349066318 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 7, 1, 0)) + 0.304090716 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 8, 1, 0)) + 0.151240907 * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 9, 1, 0)) + -0.078727359 * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0.184646202 * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0.16639535 * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + -0.613109813 * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + -0.232767584 * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + -0.159075767 * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0.22192189 * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + -0.764021869 * retail_model_variables.serviced + 0.070980927 * retail_model_variables.used + 0.001946638 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + -0.01037415 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + -0.094285971 * retail_model_variables.qtr1 + -0.241255168 * retail_model_variables.qtr2 + -0.044815803 * retail_model_variables.qtr3 + -0.601467369 * (IF (retail_model_variables.extension_seg3 = 'A: TDR TRIPP', 1, 0)) + -0.532247723 * (IF (retail_model_variables.extension_seg3 = 'B: TDR 1 EXTENSION', 1, 0)) + -0.502170384 * (IF (retail_model_variables.extension_seg3 = 'C: TDR 2 EXTENSIONs', 1, 0)) + -0.323407632 * (IF (retail_model_variables.extension_seg3 = 'D: TDR 3 or More EXTENSIONs', 1, 0)) + 1.72250853 * ( if ( retail_model_variables.bin_snapDPD_f = 3 AND retail_model_variables.date_qss = 1, 1, 0 ) ) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.used + 0d * retail_model_variables.serviced + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) ) ) ) ) WHEN (model_segment.code = 'SEG4') THEN ( EXP( ( 0d + 0d * retail_model_variables.age0_1_f + 0d * retail_model_variables.age2_3_f + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * macro_economic_factors_national_derived.6m_Manheim_gr + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d + 0d * retail_model_variables.age0_1_pd2 + 0d * retail_model_variables.age_2_pd2 + 0d * retail_model_variables.age_3_pd2 + 0d * retail_model_variables.age_4_pd2 + 0d * retail_model_variables.age_5_9_pd2 + 0d * retail_model_variables.age_10_12_pd2 + 0d * retail_model_variables.age_13_16_pd2 + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss_2 + 0d * retail_model_variables.qss_3 + 0d * retail_model_variables.qss_4 + 0d * retail_model_variables.qss_5 + 0d * retail_model_variables.qss_6 + 0d * retail_model_variables.qss_7 + 0d * retail_model_variables.qss_8 + 0d * retail_model_variables.qss_9 + 0d * retail_model_variables.qss_10 + 0d * retail_model_variables.qss_11 + 0d * retail_model_variables.qss_12 + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 IN (2, 3), 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_oltv_f_3 IN (2, 3), 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 4, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_fico_f_pd3 IN (5, 6), 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.serviced + 0d * retail_model_variables.used + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg3 = 'A: TDR TRIPP', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'B: TDR 1 EXTENSION', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'C: TDR 2 EXTENSIONs', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'D: TDR 3 or More EXTENSIONs', 1, 0)) + 0d * ( if ( retail_model_variables.bin_snapDPD_f = 3 AND retail_model_variables.date_qss = 1, 1, 0 ) ) + -3.022815222 + 0.394462892 * retail_model_variables.age4_9_f + 0.226686724 * retail_model_variables.age10_12_f + 0.055955375 * retail_model_variables.age13_16_f + -2.373420725 * retail_model_variables.qss0_1_f + -0.713786309 * retail_model_variables.qss2_3_f + -0.394563061 * retail_model_variables.qss4_9_f + -0.135363427 * retail_model_variables.qss10_12_f + -0.082013956 * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + -0.242781867 * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + -0.146790428 * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + -0.102123113 * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + -0.079914759 * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + -0.108394775 * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + -0.367522015 * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + -0.269808387 * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + -0.159201907 * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + -0.067105201 * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0.895730206 * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0.903421952 * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0.812652689 * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0.77892563 * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0.761937123 * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0.720189278 * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0.670810499 * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0.587470064 * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0.466083789 * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0.332210316 * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0.221124494 * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0.200626745 * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0.122117609 * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + -0.872735271 * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + -0.390916825 * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + -0.094230011 * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0.29182972 * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0.032549611 * retail_model_variables.used + -0.961187545 * retail_model_variables.serviced + 0.003420008 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + -0.007969134 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + -0.104403838 * retail_model_variables.qtr1 + -0.291279436 * retail_model_variables.qtr2 + -0.079087256 * retail_model_variables.qtr3 + 0.25586088 * (IF (retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month', 1, 0)) + 0.570652821 * (IF (retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month', 1, 0)) + 1.948685858 * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0.2622438 * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0.153525173 * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) ) ) / ( 1 + EXP( ( 0d + 0d * retail_model_variables.age0_1_f + 0d * retail_model_variables.age2_3_f + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * macro_economic_factors_national_derived.6m_Manheim_gr + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d + 0d * retail_model_variables.age0_1_pd2 + 0d * retail_model_variables.age_2_pd2 + 0d * retail_model_variables.age_3_pd2 + 0d * retail_model_variables.age_4_pd2 + 0d * retail_model_variables.age_5_9_pd2 + 0d * retail_model_variables.age_10_12_pd2 + 0d * retail_model_variables.age_13_16_pd2 + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss_2 + 0d * retail_model_variables.qss_3 + 0d * retail_model_variables.qss_4 + 0d * retail_model_variables.qss_5 + 0d * retail_model_variables.qss_6 + 0d * retail_model_variables.qss_7 + 0d * retail_model_variables.qss_8 + 0d * retail_model_variables.qss_9 + 0d * retail_model_variables.qss_10 + 0d * retail_model_variables.qss_11 + 0d * retail_model_variables.qss_12 + 0d * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_pti_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0d * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) + 0d + 0d * retail_model_variables.age4_9_f + 0d * retail_model_variables.age10_12_f + 0d * retail_model_variables.age13_16_f + 0d * retail_model_variables.qss0_1_f + 0d * retail_model_variables.qss2_3_f + 0d * retail_model_variables.qss4_9_f + 0d * retail_model_variables.qss10_12_f + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 IN (2, 3), 1, 0)) + 0d * (if (retail_model_variables.bin_snap_pti_f_pd3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + 0d * (if (retail_model_variables.bin_oltv_f_3 IN (2, 3), 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + 0d * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 4, 1, 0)) + 0d * (if (retail_model_variables.bin_snap_fico_f_pd3 IN (5, 6), 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 7, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 8, 1, 0)) + 0d * (IF (retail_model_variables.bin_snap_fico_f_pd3 = 9, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0d * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0d * retail_model_variables.serviced + 0d * retail_model_variables.used + 0d * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0d * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0d * retail_model_variables.qtr1 + 0d * retail_model_variables.qtr2 + 0d * retail_model_variables.qtr3 + 0d * (IF (retail_model_variables.extension_seg3 = 'A: TDR TRIPP', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'B: TDR 1 EXTENSION', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'C: TDR 2 EXTENSIONs', 1, 0)) + 0d * (IF (retail_model_variables.extension_seg3 = 'D: TDR 3 or More EXTENSIONs', 1, 0)) + 0d * ( if ( retail_model_variables.bin_snapDPD_f = 3 AND retail_model_variables.date_qss = 1, 1, 0 ) ) + -3.022815222 + 0.394462892 * retail_model_variables.age4_9_f + 0.226686724 * retail_model_variables.age10_12_f + 0.055955375 * retail_model_variables.age13_16_f + -2.373420725 * retail_model_variables.qss0_1_f + -0.713786309 * retail_model_variables.qss2_3_f + -0.394563061 * retail_model_variables.qss4_9_f + -0.135363427 * retail_model_variables.qss10_12_f + -0.082013956 * (IF (retail_model_variables.bin_pti_f = 1, 1, 0)) + -0.242781867 * (IF (retail_model_variables.bin_pti_f = 2, 1, 0)) + -0.146790428 * (IF (retail_model_variables.bin_pti_f = 3, 1, 0)) + -0.102123113 * (IF (retail_model_variables.bin_pti_f = 4, 1, 0)) + -0.079914759 * (IF (retail_model_variables.bin_pti_f = 5, 1, 0)) + -0.108394775 * (IF (retail_model_variables.bin_oltv_f_3 = 1, 1, 0)) + -0.367522015 * (IF (retail_model_variables.bin_oltv_f_3 = 2, 1, 0)) + -0.269808387 * (IF (retail_model_variables.bin_oltv_f_3 = 3, 1, 0)) + -0.159201907 * (IF (retail_model_variables.bin_oltv_f_3 = 4, 1, 0)) + -0.067105201 * (IF (retail_model_variables.bin_oltv_f_3 = 5, 1, 0)) + 0.895730206 * (IF (retail_model_variables.bin_snap_fico_f = 1, 1, 0)) + 0.903421952 * (IF (retail_model_variables.bin_snap_fico_f = 2, 1, 0)) + 0.812652689 * (IF (retail_model_variables.bin_snap_fico_f = 3, 1, 0)) + 0.77892563 * (IF (retail_model_variables.bin_snap_fico_f = 4, 1, 0)) + 0.761937123 * (IF (retail_model_variables.bin_snap_fico_f = 5, 1, 0)) + 0.720189278 * (IF (retail_model_variables.bin_snap_fico_f = 6, 1, 0)) + 0.670810499 * (IF (retail_model_variables.bin_snap_fico_f = 7, 1, 0)) + 0.587470064 * (IF (retail_model_variables.bin_snap_fico_f = 8, 1, 0)) + 0.466083789 * (IF (retail_model_variables.bin_snap_fico_f = 9, 1, 0)) + 0.332210316 * (IF (retail_model_variables.bin_snap_fico_f = 10, 1, 0)) + 0.221124494 * (IF (retail_model_variables.bin_termyr_f = 1, 1, 0)) + 0.200626745 * (IF (retail_model_variables.bin_termyr_f = 2, 1, 0)) + 0.122117609 * (IF (retail_model_variables.bin_termyr_f = 3, 1, 0)) + -0.872735271 * (IF (retail_model_variables.bin_snapDPD_f = 1, 1, 0)) + -0.390916825 * (IF (retail_model_variables.bin_snapDPD_f = 2, 1, 0)) + -0.094230011 * (IF (retail_model_variables.bin_thin_f = 1, 1, 0)) + 0.29182972 * (IF (retail_model_variables.bin_thin_f = 2, 1, 0)) + 0.032549611 * retail_model_variables.used + -0.961187545 * retail_model_variables.serviced + 0.003420008 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + -0.007969134 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + -0.104403838 * retail_model_variables.qtr1 + -0.291279436 * retail_model_variables.qtr2 + -0.079087256 * retail_model_variables.qtr3 + 0.25586088 * (IF (retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month', 1, 0)) + 0.570652821 * (IF (retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month', 1, 0)) + 1.948685858 * (IF (retail_model_variables.inter_dpd_qss2 = 'A: DPD 31 to 60 at QSS = 1', 1, 0)) + 0.2622438 * (IF (retail_model_variables.inter_dpd_qss2 = 'B: DPD 31 to 60 at QSS = 2', 1, 0)) + 0.153525173 * (IF (retail_model_variables.inter_dpd_qss2 = 'C: DPD 1 to 30 at QSS = 1 or 2', 1, 0)) ) ) ) ) ELSE (0d) END as pd_baseline, "Q" as prediction_basis, model_segment.id as model_segment, 1743661748010 as version FROM 64761be1_7bb3_45d6_88ef_6a13e3c99bf7_1616568471210_1743661746824 as retail_model_variables JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = retail_model_variables.reporting_date)) left outer JOIN 4072636e_1308_40bb_8e7b_445211dd112d_1618998480011_1743661739892 as macro_economic_factors_state_derived on ( (macro_economic_factors_state_derived.region_code = retail_model_variables.state) AND (macro_economic_factors_state_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) ) JOIN e37e8191_4060_4cb5_85de_bc78983ea194_1618998604391_1743661740452 as macro_economic_factors_national_derived on ( (macro_economic_factors_national_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) AND (macro_economic_factors_national_derived.region_code = 'US') ) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ((retail_model_variables.scenario_id = scenario.scenario_id)) JOIN e0fa9b6e_d8eb_4c61_949e_3ccf467580bb_1616568471265_1616570826147 as model_segment on ((retail_model_variables.snap_segdefault = model_segment.id)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ((retail_model_variables.portfolio_id = portfolio.id)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((retail_model_variables.state = region.code)) WHERE (1 = 1) AND (reporting_date.id = '420') AND (portfolio.id = '2') AND (scenario.scenario_id = '16')"""
___________________________________
STAGE 2 - Model Name :  Retail Secured PO
# TASK 0
Task Desc : Compute PO Baseline
Target Map name : retail_po_map
Target Table name : retail_po
SQL : """SELECT retail_model_variables.reporting_date as reporting_date, retail_model_variables.prediction_year as prediction_year, retail_model_variables.instrument_id as instrument_id, portfolio.id as portfolio_id, scenario.scenario_id as scenario_id, region.id as region_id, CASE WHEN (model_segment.code = 'SEG1') THEN ( EXP( ( -1.336956392 + -1.110444903 * retail_model_variables.age0_2_po1 + -2.031601438 * retail_model_variables.age3_30_po1 + -0.340804328 * retail_model_variables.qss0_1_po1 + -0.709671506 * retail_model_variables.qss2_7_po1 + -0.382313281 * retail_model_variables.qss8_9_po1 + -0.146380148 * retail_model_variables.qss10_13_po1 + 2.1186784522 * CASE WHEN (((retail_model_variables.bin_termyr_f = 1))) THEN (1) ELSE (0) END + 1.0507419626 * CASE WHEN (((retail_model_variables.bin_termyr_f = 2))) THEN (1) ELSE (0) END + 0.3711883695 * CASE WHEN (((retail_model_variables.bin_termyr_f = 3))) THEN (1) ELSE (0) END + -0.117423859 * retail_model_variables.used + -0.036860104 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0.0559651695 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0.1588383416 * retail_model_variables.qtr1 + 0.0717737883 * retail_model_variables.qtr2 + 0.0316437038 * retail_model_variables.qtr3 ) ) / ( 1 + EXP( ( -1.336956392 + -1.110444903 * retail_model_variables.age0_2_po1 + -2.031601438 * retail_model_variables.age3_30_po1 + -0.340804328 * retail_model_variables.qss0_1_po1 + -0.709671506 * retail_model_variables.qss2_7_po1 + -0.382313281 * retail_model_variables.qss8_9_po1 + -0.146380148 * retail_model_variables.qss10_13_po1 + 2.1186784522 * CASE WHEN (((retail_model_variables.bin_termyr_f = 1))) THEN (1) ELSE (0) END + 1.0507419626 * CASE WHEN (((retail_model_variables.bin_termyr_f = 2))) THEN (1) ELSE (0) END + 0.3711883695 * CASE WHEN (((retail_model_variables.bin_termyr_f = 3))) THEN (1) ELSE (0) END + -0.117423859 * retail_model_variables.used + -0.036860104 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0.0559651695 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0.1588383416 * retail_model_variables.qtr1 + 0.0717737883 * retail_model_variables.qtr2 + 0.0316437038 * retail_model_variables.qtr3 ) ) ) ) WHEN (model_segment.code = 'SEG2') THEN ( EXP( ( -3.583785105 + -1.283708759 * retail_model_variables.age0_1_f + -0.873687483 * retail_model_variables.age2_3_f + -0.472731854 * retail_model_variables.age4_9_f + -0.364280409 * retail_model_variables.age10_12_f + -0.2460047 * retail_model_variables.age13_16_f + 0.028837707 * retail_model_variables.qss0_1_f + 0.0108798917 * retail_model_variables.qss2_3_f + -0.05984913 * retail_model_variables.qss4_9_f + -0.06430626 * retail_model_variables.qss10_12_f + -0.300811835 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 1))) THEN (1) ELSE (0) END + -0.750975963 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 2))) THEN (1) ELSE (0) END + -0.511110687 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 3))) THEN (1) ELSE (0) END + -0.26300692 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 4))) THEN (1) ELSE (0) END + 0.6113313245 * CASE WHEN (((retail_model_variables.bin_termyr_f = 2))) THEN (1) ELSE (0) END + 0.0757427047 * CASE WHEN (((retail_model_variables.bin_termyr_f = 3))) THEN (1) ELSE (0) END + 1.0927511007 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 1))) THEN (1) ELSE (0) END + 0.4541711763 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 2))) THEN (1) ELSE (0) END + 0.0417495477 * CASE WHEN (((retail_model_variables.bin_oltv_f_2 = 1))) THEN (1) ELSE (0) END + 0.2347790707 * CASE WHEN (((retail_model_variables.bin_oltv_f_2 = 2))) THEN (1) ELSE (0) END + 0.1095992821 * CASE WHEN (((retail_model_variables.bin_snap_pti_f_2 = 1))) THEN (1) ELSE (0) END + 0.1173413688 * CASE WHEN (((retail_model_variables.bin_snap_pti_f_2 = 2))) THEN (1) ELSE (0) END + -0.049672856 * ((COALESCE(macro_economic_factors_state_derived.flbr, macro_economic_factors_national_derived.flbr))) + -0.016234959 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0.0359760402 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0.0937908594 * retail_model_variables.qtr1 + 0.1932147589 * retail_model_variables.qtr2 + 0.1405580165 * retail_model_variables.qtr3 + -1.044937197 * CASE WHEN (((retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)'))) THEN (1) ELSE (0) END ) ) / ( 1 + EXP( ( -3.583785105 + -1.283708759 * retail_model_variables.age0_1_f + -0.873687483 * retail_model_variables.age2_3_f + -0.472731854 * retail_model_variables.age4_9_f + -0.364280409 * retail_model_variables.age10_12_f + -0.2460047 * retail_model_variables.age13_16_f + 0.028837707 * retail_model_variables.qss0_1_f + 0.0108798917 * retail_model_variables.qss2_3_f + -0.05984913 * retail_model_variables.qss4_9_f + -0.06430626 * retail_model_variables.qss10_12_f + -0.300811835 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 1))) THEN (1) ELSE (0) END + -0.750975963 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 2))) THEN (1) ELSE (0) END + -0.511110687 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 3))) THEN (1) ELSE (0) END + -0.26300692 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 4))) THEN (1) ELSE (0) END + 0.6113313245 * CASE WHEN (((retail_model_variables.bin_termyr_f = 2))) THEN (1) ELSE (0) END + 0.0757427047 * CASE WHEN (((retail_model_variables.bin_termyr_f = 3))) THEN (1) ELSE (0) END + 1.0927511007 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 1))) THEN (1) ELSE (0) END + 0.4541711763 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 2))) THEN (1) ELSE (0) END + 0.0417495477 * CASE WHEN (((retail_model_variables.bin_oltv_f_2 = 1))) THEN (1) ELSE (0) END + 0.2347790707 * CASE WHEN (((retail_model_variables.bin_oltv_f_2 = 2))) THEN (1) ELSE (0) END + 0.1095992821 * CASE WHEN (((retail_model_variables.bin_snap_pti_f_2 = 1))) THEN (1) ELSE (0) END + 0.1173413688 * CASE WHEN (((retail_model_variables.bin_snap_pti_f_2 = 2))) THEN (1) ELSE (0) END + -0.049672856 * ((COALESCE(macro_economic_factors_state_derived.flbr, macro_economic_factors_national_derived.flbr))) + -0.016234959 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0.0359760402 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0.0937908594 * retail_model_variables.qtr1 + 0.1932147589 * retail_model_variables.qtr2 + 0.1405580165 * retail_model_variables.qtr3 + -1.044937197 * CASE WHEN (((retail_model_variables.extension_seg2 = 'A: Non-TDR 1 EXTENSION of 1 or 2 Month(s)'))) THEN (1) ELSE (0) END ) ) ) ) WHEN (model_segment.code = 'SEG3') THEN ( EXP( ( -1.496872564 + -3.632301685 * retail_model_variables.age4_9_po3 + -2.526431642 * retail_model_variables.age10_12_po3 + -1.492451781 * retail_model_variables.age13_23_po3 + -0.113327515 * retail_model_variables.qss0_1_f + -0.046447122 * retail_model_variables.qss2_3_f + -0.042841169 * retail_model_variables.qss4_9_f + -0.054314753 * retail_model_variables.qss10_12_f + -0.696398903 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 1))) THEN (1) ELSE (0) END + -0.683978631 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 2))) THEN (1) ELSE (0) END + -0.456308627 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 3))) THEN (1) ELSE (0) END + -0.247968239 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 4))) THEN (1) ELSE (0) END + 0.4981046409 * CASE WHEN (((retail_model_variables.bin_thin_f = 1))) THEN (1) ELSE (0) END + -0.220508343 * CASE WHEN (((retail_model_variables.bin_thin_f = 2))) THEN (1) ELSE (0) END + 0.9365042699 * CASE WHEN (((retail_model_variables.bin_termyr_f = 1))) THEN (1) ELSE (0) END + 1.4028853143 * CASE WHEN (((retail_model_variables.bin_termyr_f = 2))) THEN (1) ELSE (0) END + 0.6463239245 * CASE WHEN (((retail_model_variables.bin_termyr_f = 3))) THEN (1) ELSE (0) END + 0.487648577 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 1))) THEN (1) ELSE (0) END + 0.1960545541 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 2))) THEN (1) ELSE (0) END + -0.080251454 * CASE WHEN (((retail_model_variables.bin_oltv_f_2 = 1))) THEN (1) ELSE (0) END + 0.069026608 * CASE WHEN (((retail_model_variables.bin_oltv_f_2 = 2))) THEN (1) ELSE (0) END + -0.140649088 * ((COALESCE(macro_economic_factors_state_derived.flbr, macro_economic_factors_national_derived.flbr))) + -0.005905951 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0.0430539341 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0.1935025529 * retail_model_variables.qtr1 + 0.0788500854 * retail_model_variables.qtr2 + 0.055808811 * retail_model_variables.qtr3 ) ) / ( 1 + EXP( ( -1.496872564 + -3.632301685 * retail_model_variables.age4_9_po3 + -2.526431642 * retail_model_variables.age10_12_po3 + -1.492451781 * retail_model_variables.age13_23_po3 + -0.113327515 * retail_model_variables.qss0_1_f + -0.046447122 * retail_model_variables.qss2_3_f + -0.042841169 * retail_model_variables.qss4_9_f + -0.054314753 * retail_model_variables.qss10_12_f + -0.696398903 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 1))) THEN (1) ELSE (0) END + -0.683978631 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 2))) THEN (1) ELSE (0) END + -0.456308627 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 3))) THEN (1) ELSE (0) END + -0.247968239 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 4))) THEN (1) ELSE (0) END + 0.4981046409 * CASE WHEN (((retail_model_variables.bin_thin_f = 1))) THEN (1) ELSE (0) END + -0.220508343 * CASE WHEN (((retail_model_variables.bin_thin_f = 2))) THEN (1) ELSE (0) END + 0.9365042699 * CASE WHEN (((retail_model_variables.bin_termyr_f = 1))) THEN (1) ELSE (0) END + 1.4028853143 * CASE WHEN (((retail_model_variables.bin_termyr_f = 2))) THEN (1) ELSE (0) END + 0.6463239245 * CASE WHEN (((retail_model_variables.bin_termyr_f = 3))) THEN (1) ELSE (0) END + 0.487648577 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 1))) THEN (1) ELSE (0) END + 0.1960545541 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 2))) THEN (1) ELSE (0) END + -0.080251454 * CASE WHEN (((retail_model_variables.bin_oltv_f_2 = 1))) THEN (1) ELSE (0) END + 0.069026608 * CASE WHEN (((retail_model_variables.bin_oltv_f_2 = 2))) THEN (1) ELSE (0) END + -0.140649088 * ((COALESCE(macro_economic_factors_state_derived.flbr, macro_economic_factors_national_derived.flbr))) + -0.005905951 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0.0430539341 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0.1935025529 * retail_model_variables.qtr1 + 0.0788500854 * retail_model_variables.qtr2 + 0.055808811 * retail_model_variables.qtr3 ) ) ) ) WHEN (model_segment.code = 'SEG4') THEN ( EXP( ( -1.793874224 + -2.21563802 * retail_model_variables.age4_15_po4_v2 + -1.606122399 * retail_model_variables.age15_19_po4_v2 + -0.514147881 * retail_model_variables.age20_24_po4_v2 + 0.179658246 * retail_model_variables.qss0_1_f + 0.1879188014 * retail_model_variables.qss2_3_f + 0.1895958129 * retail_model_variables.qss4_9_f + 0.1023928447 * retail_model_variables.qss10_12_f + -1.019086 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 1))) THEN (1) ELSE (0) END + -0.687154534 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 2))) THEN (1) ELSE (0) END + -0.454414189 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 3))) THEN (1) ELSE (0) END + -0.179208786 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 4))) THEN (1) ELSE (0) END + 1.0499158015 * CASE WHEN (((retail_model_variables.bin_termyr_f = 1))) THEN (1) ELSE (0) END + 1.3715309544 * CASE WHEN (((retail_model_variables.bin_termyr_f = 2))) THEN (1) ELSE (0) END + 0.6827734816 * CASE WHEN (((retail_model_variables.bin_termyr_f = 3))) THEN (1) ELSE (0) END + 0.7583647526 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 1))) THEN (1) ELSE (0) END + 0.3718064434 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 2))) THEN (1) ELSE (0) END + -0.022626392 * ((COALESCE(macro_economic_factors_state_derived.flbr, macro_economic_factors_national_derived.flbr))) + -0.018389368 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0.0176247474 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0.1453624858 * retail_model_variables.qtr1 + 0.0981884913 * retail_model_variables.qtr2 + 0.0847038833 * retail_model_variables.qtr3 + -0.096420223 * CASE WHEN (((retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month'))) THEN (1) ELSE (0) END + -0.426505878 * CASE WHEN (((retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month'))) THEN (1) ELSE (0) END ) ) / ( 1 + EXP( ( -1.793874224 + -2.21563802 * retail_model_variables.age4_15_po4_v2 + -1.606122399 * retail_model_variables.age15_19_po4_v2 + -0.514147881 * retail_model_variables.age20_24_po4_v2 + 0.179658246 * retail_model_variables.qss0_1_f + 0.1879188014 * retail_model_variables.qss2_3_f + 0.1895958129 * retail_model_variables.qss4_9_f + 0.1023928447 * retail_model_variables.qss10_12_f + -1.019086 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 1))) THEN (1) ELSE (0) END + -0.687154534 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 2))) THEN (1) ELSE (0) END + -0.454414189 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 3))) THEN (1) ELSE (0) END + -0.179208786 * CASE WHEN (((retail_model_variables.bin_snap_fico_po = 4))) THEN (1) ELSE (0) END + 1.0499158015 * CASE WHEN (((retail_model_variables.bin_termyr_f = 1))) THEN (1) ELSE (0) END + 1.3715309544 * CASE WHEN (((retail_model_variables.bin_termyr_f = 2))) THEN (1) ELSE (0) END + 0.6827734816 * CASE WHEN (((retail_model_variables.bin_termyr_f = 3))) THEN (1) ELSE (0) END + 0.7583647526 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 1))) THEN (1) ELSE (0) END + 0.3718064434 * CASE WHEN (((retail_model_variables.bin_snapDPD_f = 2))) THEN (1) ELSE (0) END + -0.022626392 * ((COALESCE(macro_economic_factors_state_derived.flbr, macro_economic_factors_national_derived.flbr))) + -0.018389368 * ((COALESCE(macro_economic_factors_state_derived.six_m_flbr_state, macro_economic_factors_national_derived.six_m_flbr))) + 0.0176247474 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + 0.1453624858 * retail_model_variables.qtr1 + 0.0981884913 * retail_model_variables.qtr2 + 0.0847038833 * retail_model_variables.qtr3 + -0.096420223 * CASE WHEN (((retail_model_variables.extension_seg4 = 'A: Non-TDR 1 EXTENSION of 1 Month'))) THEN (1) ELSE (0) END + -0.426505878 * CASE WHEN (((retail_model_variables.extension_seg4 = 'B: Non-TDR 1 EXTENSION of 2 Month'))) THEN (1) ELSE (0) END ) ) ) ) ELSE (0) END as po_baseline, "Q" as prediction_basis, model_segment.id as model_segment, 1743661748649 as version FROM 64761be1_7bb3_45d6_88ef_6a13e3c99bf7_1616568471210_1743661746824 as retail_model_variables JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = retail_model_variables.reporting_date)) left outer JOIN 4072636e_1308_40bb_8e7b_445211dd112d_1618998480011_1743661739892 as macro_economic_factors_state_derived on ( (macro_economic_factors_state_derived.region_code = retail_model_variables.state) AND (macro_economic_factors_state_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) ) JOIN e37e8191_4060_4cb5_85de_bc78983ea194_1618998604391_1743661740452 as macro_economic_factors_national_derived on ( (macro_economic_factors_national_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) AND (macro_economic_factors_national_derived.region_code = 'US') ) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ((retail_model_variables.scenario_id = scenario.scenario_id)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ((retail_model_variables.portfolio_id = portfolio.id)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((instrument_detail_retail.loan_key = retail_model_variables.instrument_id)) JOIN e0fa9b6e_d8eb_4c61_949e_3ccf467580bb_1616568471265_1616570826147 as model_segment on ((retail_model_variables.snap_segdefault = model_segment.id)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((retail_model_variables.state = region.code)) WHERE (1 = 1) AND (reporting_date.id = '420') AND (portfolio.id = '2') AND (scenario.scenario_id = '16')"""
___________________________________
Stage 3 - Model Name :  Retail Secured EAD
# TASK 0
TASK Desc : Compute EAD Baseline
Target Map name : retail_ead_map
Target Table name : retail_ead
SQL : """ SELECT retail_model_variables.reporting_date as reporting_date, retail_model_variables.prediction_year as prediction_year, retail_model_variables.instrument_id as instrument_id, portfolio.id as portfolio_id, scenario.scenario_id as scenario_id, region.id as region_id, CASE WHEN (1 = 1) THEN ( 1.0033137661 + -0.119849394 * CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END + 0.0270245298 * CASE WHEN (((instrument_detail_retail.thin_file_ind = 'Y'))) THEN (1) ELSE (0) END + -0.004509012 * retail_model_variables.qtr_dummy_1 + 0.0346177963 * retail_model_variables.qob_ead_2_3 + 0.075879516 * retail_model_variables.qob_ead_4_5 + 0.126957494 * retail_model_variables.qob_ead_6_7 + 0.1734554466 * retail_model_variables.qob_ead_8_9 + 0.2089722654 * retail_model_variables.qob_ead_10_11 + 0.2593146576 * retail_model_variables.qob_ead_12_15 + 0.3100507921 * retail_model_variables.qob_ead_16_17 + 0.3303143552 * retail_model_variables.qob_ead_18_19 + 0.458820237 * retail_model_variables.qob_ead_ge20 + 0.0485604357 * retail_model_variables.qss_ead_2_3 + 0.1156349224 * retail_model_variables.qss_ead_4_5 + 0.2160404331 * retail_model_variables.qss_ead_6_7 + 0.3399250583 * retail_model_variables.qss_ead_8_9 + 0.4978507048 * retail_model_variables.qss_ead_10_11 + 0.6650055603 * retail_model_variables.qss_ead_12_13 + 0.8092803102 * retail_model_variables.qss_ead_ge14 ) ELSE (0d) END as ead_baseline, "Q" as prediction_basis, model_segment.id as model_segment, 1743661748976 as version FROM 64761be1_7bb3_45d6_88ef_6a13e3c99bf7_1616568471210_1743661746824 as retail_model_variables JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = retail_model_variables.reporting_date)) left outer JOIN 4072636e_1308_40bb_8e7b_445211dd112d_1618998480011_1743661739892 as macro_economic_factors_state_derived on ( (macro_economic_factors_state_derived.region_code = retail_model_variables.state) AND (macro_economic_factors_state_derived.prediction_year = retail_model_variables.prediction_year) ) JOIN e37e8191_4060_4cb5_85de_bc78983ea194_1618998604391_1743661740452 as macro_economic_factors_national_derived on ( (macro_economic_factors_national_derived.prediction_year = retail_model_variables.prediction_year) AND (macro_economic_factors_national_derived.region_code = 'US') ) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ((retail_model_variables.scenario_id = scenario.scenario_id)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ((retail_model_variables.portfolio_id = portfolio.id)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((instrument_detail_retail.loan_key = retail_model_variables.instrument_id)) JOIN e0fa9b6e_d8eb_4c61_949e_3ccf467580bb_1616568471265_1616570826147 as model_segment on ((retail_model_variables.snap_segdefault = model_segment.id)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((retail_model_variables.state = region.code)) WHERE (1 = 1) AND (reporting_date.id = '420') AND (portfolio.id = '2') AND (scenario.scenario_id = '16')"""
___________________________________
STAGE 4 - Model Name :  Retail Secured Exposure
# TASK 0
Task Desc : Compute Exposure Baseline
Target Map name : retail_exposure_map
Target Table name : retail_exposure
SQL : """SELECT retail_model_variables.reporting_date as reporting_date, retail_model_variables.prediction_year as prediction_year, retail_model_variables.instrument_id as instrument_id, portfolio.id as portfolio_id, scenario.scenario_id as scenario_id, region.id as region_id, CASE WHEN (1 = 1) THEN ( 0.368911449 + 0.0031083623 * ((COALESCE(macro_economic_factors_state_derived.hpi_state_b_6mgr, macro_economic_factors_national_derived.hpi_national_6mgr))) + -0.012997766 * CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END + 0.0550377003 * CASE WHEN ( ( (retail_model_variables.qtr_dummy_1 = 1) or (retail_model_variables.qtr_dummy_2 = 1) ) ) THEN (1) ELSE (0) END + 0.0820190729 * retail_model_variables.pymt_age_3_4 + 0.1154747236 * retail_model_variables.pymt_age_5_7 + 0.1648045384 * retail_model_variables.pymt_age_8_11 + 0.2202540742 * retail_model_variables.pymt_age_12_12 + 0.2360115964 * retail_model_variables.pymt_age_13_15 + 0.2707158262 * retail_model_variables.pymt_age_16_17 + 0.2935489977 * retail_model_variables.pymt_age_18_19 + 0.3969258487 * retail_model_variables.pymt_age_ge_20 + -0.026776893 * retail_model_variables.pymt_qss_2_2 + -0.031247868 * retail_model_variables.pymt_qss_3_4 + -0.055114562 * retail_model_variables.pymt_qss_5_6 + -0.066471028 * retail_model_variables.pymt_qss_7_8 + -0.077793518 * retail_model_variables.pymt_qss_9_10 + -0.087622333 * retail_model_variables.pymt_qss_11_11 + -0.096606596 * retail_model_variables.pymt_qss_12_13 + -0.109569357 * retail_model_variables.pymt_qss_ge_14 + 0.0601225061 * retail_model_variables.lfs_missing + 0.0403756523 * retail_model_variables.lfs_501_550 + 0.0798695898 * retail_model_variables.lfs_551_600 + 0.1392042698 * retail_model_variables.lfs_601_650 + 0.1816765125 * retail_model_variables.lfs_651_700 + 0.20462652 * retail_model_variables.lfs_701_900 + 0.1786953451 * retail_model_variables.dpd_le_zero + 0.0583003381 * retail_model_variables.dpd_1_30 ) ELSE (0) END as exposure_baseline, "Q" as prediction_basis, model_segment.id as model_segment, 1743661749364 as version FROM 64761be1_7bb3_45d6_88ef_6a13e3c99bf7_1616568471210_1743661746824 as retail_model_variables JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = retail_model_variables.reporting_date)) left outer JOIN 4072636e_1308_40bb_8e7b_445211dd112d_1618998480011_1743661739892 as macro_economic_factors_state_derived on ( (macro_economic_factors_state_derived.region_code = retail_model_variables.state) AND (macro_economic_factors_state_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) ) JOIN e37e8191_4060_4cb5_85de_bc78983ea194_1618998604391_1743661740452 as macro_economic_factors_national_derived on ( (macro_economic_factors_national_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) AND (macro_economic_factors_national_derived.region_code = 'US') ) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ((retail_model_variables.scenario_id = scenario.scenario_id)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ((retail_model_variables.portfolio_id = portfolio.id)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((instrument_detail_retail.loan_key = retail_model_variables.instrument_id)) JOIN e0fa9b6e_d8eb_4c61_949e_3ccf467580bb_1616568471265_1616570826147 as model_segment on ((retail_model_variables.snap_segdefault = model_segment.id)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((retail_model_variables.state = region.code)) WHERE (1 = 1) AND (reporting_date.id = '420') AND (portfolio.id = '2') AND (scenario.scenario_id = '16')"""
___________________________________
STAGE 5 - Model Name :  Retail Secured LGD
# TASK 0
Task Desc : Compute LGD
Target Map name : retail_lgd_map
Target Table name : retail_lgd
SQL : """WITH instrument_lgd_baseline_stg_map_dlagcalc_base AS ( SELECT retail_model_variables.reporting_date as reporting_date, retail_model_variables.prediction_year as prediction_year, retail_model_variables.instrument_id as instrument_id, portfolio.id as portfolio_id, scenario.scenario_id as scenario_id, region.id as region_id, instrument_detail_retail.eom_balance_amt as eom_balance_amt, instrument_detail_retail.collateral_market_value_amt as market_value, ( (macro_economic_factors_national_derived.Manheim) / ( lag(macro_economic_factors_national_derived.Manheim, 1) over ( partition by retail_model_variables.instrument_id order by retail_model_variables.prediction_year ) ) ) as qoq_manheim_ratio, CASE WHEN retail_model_variables.date_qss = 0 THEN instrument_detail_retail.eom_balance_amt ELSE greatest(fv (greatest(power((1 + instrument_detail_retail.current_interest_rate), (1 / 12)) - 1, .00000000001), retail_model_variables.date_qss * 3, instrument_detail_retail.scheduled_payment_amt, - (instrument_detail_retail.eom_balance_amt), 0), 0) END as fb_default, "Q" as prediction_basis, model_segment.id as model_segment, 1743661750005 as version FROM 64761be1_7bb3_45d6_88ef_6a13e3c99bf7_1616568471210_1743661746824 as retail_model_variables JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = retail_model_variables.reporting_date)) JOIN 4072636e_1308_40bb_8e7b_445211dd112d_1618998480011_1743661739892 as macro_economic_factors_state_derived on ( (macro_economic_factors_state_derived.region_code = retail_model_variables.state) AND (macro_economic_factors_state_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) ) JOIN e37e8191_4060_4cb5_85de_bc78983ea194_1618998604391_1743661740452 as macro_economic_factors_national_derived on ( (macro_economic_factors_national_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) AND (macro_economic_factors_national_derived.region_code = 'US') ) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ((retail_model_variables.scenario_id = scenario.scenario_id)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ((retail_model_variables.portfolio_id = portfolio.id)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((instrument_detail_retail.loan_key = retail_model_variables.instrument_id)) JOIN e0fa9b6e_d8eb_4c61_949e_3ccf467580bb_1616568471265_1616570826147 as model_segment on ((retail_model_variables.snap_segdefault = model_segment.id)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((retail_model_variables.state = region.code)) WHERE (1 = 1) AND (reporting_date.id = '420') AND (portfolio.id = '2') AND (scenario.scenario_id = '16') SORT BY retail_model_variables.reporting_date, retail_model_variables.instrument_id, retail_model_variables.prediction_year ), instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc AS ( SELECT instrument_lgd_baseline_stg_map_dlagcalc_base.reporting_date, instrument_lgd_baseline_stg_map_dlagcalc_base.instrument_id, dlagcalc6 ( sort_array ( collect_list ( struct ( instrument_lgd_baseline_stg_map_dlagcalc_base.prediction_year, array ( CASE WHEN CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.prediction_year AS DOUBLE) IS NOT NULL THEN CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.prediction_year AS DOUBLE) ELSE 0d END, CASE WHEN CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.market_value AS DOUBLE) IS NOT NULL THEN CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.market_value AS DOUBLE) ELSE 0d END, CASE WHEN CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.qoq_manheim_ratio AS DOUBLE) IS NOT NULL THEN CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.qoq_manheim_ratio AS DOUBLE) ELSE 0d END, CASE WHEN CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.fb_default AS DOUBLE) IS NOT NULL THEN CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.fb_default AS DOUBLE) ELSE 0d END, 0d, 0d ) as inputValueArr ) ) ), ' market_value;( fb_default/ mv_default_calc)*100', ' mv_default_calc$dlag1 *  qoq_manheim_ratio;( fb_default/ mv_default_calc)*100', 'prediction_year,market_value,qoq_manheim_ratio,fb_default,mv_default_calc,fb_ltv_default,prediction_year$dlag1,market_value$dlag1,qoq_manheim_ratio$dlag1,fb_default$dlag1,mv_default_calc$dlag1,fb_ltv_default$dlag1', '1743661750005_null_null' ) AS instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols FROM instrument_lgd_baseline_stg_map_dlagcalc_base AS instrument_lgd_baseline_stg_map_dlagcalc_base GROUP BY instrument_lgd_baseline_stg_map_dlagcalc_base.reporting_date, instrument_lgd_baseline_stg_map_dlagcalc_base.instrument_id ), instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode AS ( SELECT instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc.reporting_date, instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc.instrument_id, explode (instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc.instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols) AS instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols FROM instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc ), instrument_lgd_baseline_stg_map AS ( SELECT CAST(instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.reporting_date AS string) AS reporting_date, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_id AS string) AS instrument_id, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.portfolio_id AS integer) AS portfolio_id, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.scenario_id AS integer) AS scenario_id, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.region_id AS integer) AS region_id, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.eom_balance_amt AS double) AS eom_balance_amt, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.prediction_basis AS string) AS prediction_basis, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.model_segment AS integer) AS model_segment, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base.version AS long) AS version, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols.column_0 AS string) AS prediction_year, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols.column_1 AS double) AS market_value, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols.column_2 AS double) AS qoq_manheim_ratio, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols.column_3 AS double) AS fb_default, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols.column_4 AS double) AS mv_default_calc, CAST(instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols.column_5 AS double) AS fb_ltv_default FROM instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode JOIN instrument_lgd_baseline_stg_map_dlagcalc_base ON instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.reporting_date = instrument_lgd_baseline_stg_map_dlagcalc_base.reporting_date AND instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_id = instrument_lgd_baseline_stg_map_dlagcalc_base.instrument_id AND instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_explode.instrument_lgd_baseline_stg_map_dlagcalc_base_dlagcalc_allcols.column_0 = instrument_lgd_baseline_stg_map_dlagcalc_base.prediction_year ), instrument_lgd_baseline_stg_2_map AS ( SELECT instrument_lgd_baseline_stg.reporting_date as reporting_date, instrument_lgd_baseline_stg.prediction_year as prediction_year, instrument_lgd_baseline_stg.instrument_id as instrument_id, instrument_lgd_baseline_stg.portfolio_id as portfolio_id, instrument_lgd_baseline_stg.scenario_id as scenario_id, instrument_lgd_baseline_stg.region_id as region_id, instrument_lgd_baseline_stg.eom_balance_amt as eom_balance_amt, instrument_lgd_baseline_stg.market_value as market_value, instrument_lgd_baseline_stg.qoq_manheim_ratio as qoq_manheim_ratio, instrument_lgd_baseline_stg.fb_default as fb_default, instrument_lgd_baseline_stg.prediction_basis as prediction_basis, instrument_lgd_baseline_stg.model_segment as model_segment, instrument_lgd_baseline_stg.mv_default_calc as mv_default_calc, instrument_lgd_baseline_stg.fb_ltv_default as fb_ltv_default, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default <= 0 THEN 1 ELSE 0 END as fb_def_ltv_missing, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 0 AND instrument_lgd_baseline_stg.fb_ltv_default <= 25 THEN 1 ELSE 0 END as fb_def_ltv_1_25, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 25 AND instrument_lgd_baseline_stg.fb_ltv_default <= 45 THEN 1 ELSE 0 END as fb_def_ltv_26_45, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 45 AND instrument_lgd_baseline_stg.fb_ltv_default <= 70 THEN 1 ELSE 0 END as fb_def_ltv_46_70, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 70 AND instrument_lgd_baseline_stg.fb_ltv_default <= 95 THEN 1 ELSE 0 END as fb_def_ltv_71_95, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 95 AND instrument_lgd_baseline_stg.fb_ltv_default <= 115 THEN 1 ELSE 0 END as fb_def_ltv_96_115, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 115 AND instrument_lgd_baseline_stg.fb_ltv_default <= 140 THEN 1 ELSE 0 END as fb_def_ltv_116_140, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 140 AND instrument_lgd_baseline_stg.fb_ltv_default <= 160 THEN 1 ELSE 0 END as fb_def_ltv_141_160, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 160 AND instrument_lgd_baseline_stg.fb_ltv_default <= 180 THEN 1 ELSE 0 END as fb_def_ltv_161_180, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 180 AND instrument_lgd_baseline_stg.fb_ltv_default <= 205 THEN 1 ELSE 0 END as fb_def_ltv_181_205, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 205 AND instrument_lgd_baseline_stg.fb_ltv_default <= 250 THEN 1 ELSE 0 END as fb_def_ltv_206_250, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 250 AND instrument_lgd_baseline_stg.fb_ltv_default <= 300 THEN 1 ELSE 0 END as fb_def_ltv_251_300, CASE WHEN instrument_lgd_baseline_stg.fb_ltv_default > 300 THEN 1 ELSE 0 END as fb_def_ltv_ge_300, 1743661750005 as version FROM instrument_lgd_baseline_stg_map as instrument_lgd_baseline_stg JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = instrument_lgd_baseline_stg.reporting_date)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((instrument_detail_retail.loan_key = instrument_lgd_baseline_stg.instrument_id)) WHERE (1 = 1) ) SELECT retail_model_variables.reporting_date as reporting_date, retail_model_variables.prediction_year as prediction_year, retail_model_variables.instrument_id as instrument_id, portfolio.id as portfolio_id, scenario.scenario_id as scenario_id, region.id as region_id, CASE WHEN (1 = 1) THEN ( 0.181888180477004 + -0.00103367075141564 * macro_economic_factors_national_derived.y_Manheim_gr + 0.0310278372292772 * instrument_lgd_baseline_stg_2.fb_def_ltv_missing + 0.0856047086653673 * instrument_lgd_baseline_stg_2.fb_def_ltv_26_45 + 0.195274025882922 * instrument_lgd_baseline_stg_2.fb_def_ltv_46_70 + 0.29227254657688 * instrument_lgd_baseline_stg_2.fb_def_ltv_71_95 + 0.367897901762147 * instrument_lgd_baseline_stg_2.fb_def_ltv_96_115 + 0.429425214632892 * instrument_lgd_baseline_stg_2.fb_def_ltv_116_140 + 0.467461387841037 * instrument_lgd_baseline_stg_2.fb_def_ltv_141_160 + 0.493707519977514 * instrument_lgd_baseline_stg_2.fb_def_ltv_161_180 + 0.515362554597494 * instrument_lgd_baseline_stg_2.fb_def_ltv_181_205 + 0.543666796531478 * instrument_lgd_baseline_stg_2.fb_def_ltv_206_250 + 0.567107757010212 * instrument_lgd_baseline_stg_2.fb_def_ltv_251_300 + 0.59603831529165 * instrument_lgd_baseline_stg_2.fb_def_ltv_ge_300 + -0.0160552285941797 * ( CASE WHEN UPPER(instrument_detail_retail.new_used_code) = 'N' THEN 1 else 0 END ) + 0.0469048623753778 * (IF (instrument_detail_retail.tdr_ind = 'Y', 1, 0)) + -0.0146220065458744 * retail_model_variables.qtr_dummy_1 + 0.00684987000849034 * retail_model_variables.qtr_dummy_2 + 0.0113512373244872 * retail_model_variables.qtr_dummy_3 + 0.0138237638155505 * retail_model_variables.qss_lgd_2 + 0.0182485965995404 * retail_model_variables.qss_lgd_3_4 + 0.022301968969241 * retail_model_variables.qss_lgd_5_6 + 0.0324267536163096 * retail_model_variables.qss_lgd_7_8 + 0.0450211137212903 * retail_model_variables.qss_lgd_9_10 + 0.0557218158528103 * retail_model_variables.qss_lgd_11_12 + 0.0695287561965708 * retail_model_variables.qss_lgd_13_14 + 0.0890135679491386 * retail_model_variables.qss_lgd_15 + -0.0302856618763586 * retail_model_variables.compact_car + -0.0339938496881211 * retail_model_variables.compact_midsize_pickup + -0.0369747239704665 * retail_model_variables.small_suv + -0.00812674144556261 * retail_model_variables.large_pickup_rc + -0.0281782234355853 * retail_model_variables.sports_car + -0.0169821249211764 * retail_model_variables.luxury + -0.0110240836391207 * retail_model_variables.large_mid_car + -0.0145733159903971 * retail_model_variables.large_mid_suv ) ELSE ( 0.181888180477004 + -0.00103367075141564 * macro_economic_factors_national_derived.y_Manheim_gr + 0.0310278372292772 * instrument_lgd_baseline_stg_2.fb_def_ltv_missing + 0.0856047086653673 * instrument_lgd_baseline_stg_2.fb_def_ltv_26_45 + 0.195274025882922 * instrument_lgd_baseline_stg_2.fb_def_ltv_46_70 + 0.29227254657688 * instrument_lgd_baseline_stg_2.fb_def_ltv_71_95 + 0.367897901762147 * instrument_lgd_baseline_stg_2.fb_def_ltv_96_115 + 0.429425214632892 * instrument_lgd_baseline_stg_2.fb_def_ltv_116_140 + 0.467461387841037 * instrument_lgd_baseline_stg_2.fb_def_ltv_141_160 + 0.493707519977514 * instrument_lgd_baseline_stg_2.fb_def_ltv_161_180 + 0.515362554597494 * instrument_lgd_baseline_stg_2.fb_def_ltv_181_205 + 0.543666796531478 * instrument_lgd_baseline_stg_2.fb_def_ltv_206_250 + 0.567107757010212 * instrument_lgd_baseline_stg_2.fb_def_ltv_251_300 + 0.59603831529165 * instrument_lgd_baseline_stg_2.fb_def_ltv_ge_300 + -0.0160552285941797 * ( CASE WHEN UPPER(instrument_detail_retail.new_used_code) = 'N' THEN 1 else 0 END ) + 0.0469048623753778 * (IF (instrument_detail_retail.tdr_ind = 'Y', 1, 0)) + -0.0146220065458744 * retail_model_variables.qtr_dummy_1 + 0.00684987000849034 * retail_model_variables.qtr_dummy_2 + 0.0113512373244872 * retail_model_variables.qtr_dummy_3 + 0.0138237638155505 * retail_model_variables.qss_lgd_2 + 0.0182485965995404 * retail_model_variables.qss_lgd_3_4 + 0.022301968969241 * retail_model_variables.qss_lgd_5_6 + 0.0324267536163096 * retail_model_variables.qss_lgd_7_8 + 0.0450211137212903 * retail_model_variables.qss_lgd_9_10 + 0.0557218158528103 * retail_model_variables.qss_lgd_11_12 + 0.0695287561965708 * retail_model_variables.qss_lgd_13_14 + 0.0890135679491386 * retail_model_variables.qss_lgd_15 + -0.0302856618763586 * retail_model_variables.compact_car + -0.0339938496881211 * retail_model_variables.compact_midsize_pickup + -0.0369747239704665 * retail_model_variables.small_suv + -0.00812674144556261 * retail_model_variables.large_pickup_rc + -0.0281782234355853 * retail_model_variables.sports_car + -0.0169821249211764 * retail_model_variables.luxury + -0.0110240836391207 * retail_model_variables.large_mid_car + -0.0145733159903971 * retail_model_variables.large_mid_suv ) END as lgd_baseline, "Q" as prediction_basis, model_segment.id as model_segment, 1743661750005 as version FROM 64761be1_7bb3_45d6_88ef_6a13e3c99bf7_1616568471210_1743661746824 as retail_model_variables JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.reporting_date_name = retail_model_variables.reporting_date)) left outer JOIN 4072636e_1308_40bb_8e7b_445211dd112d_1618998480011_1743661739892 as macro_economic_factors_state_derived on ( (macro_economic_factors_state_derived.region_code = retail_model_variables.state) AND (macro_economic_factors_state_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) ) JOIN e37e8191_4060_4cb5_85de_bc78983ea194_1618998604391_1743661740452 as macro_economic_factors_national_derived on ( (macro_economic_factors_national_derived.prediction_year = (add_months(retail_model_variables.prediction_year, 0))) AND (macro_economic_factors_national_derived.region_code = 'US') ) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ((retail_model_variables.scenario_id = scenario.scenario_id)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ((retail_model_variables.portfolio_id = portfolio.id)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((instrument_detail_retail.loan_key = retail_model_variables.instrument_id)) JOIN e0fa9b6e_d8eb_4c61_949e_3ccf467580bb_1616568471265_1616570826147 as model_segment on ((retail_model_variables.snap_segdefault = model_segment.id)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((retail_model_variables.state = region.code)) JOIN instrument_lgd_baseline_stg_2_map as instrument_lgd_baseline_stg_2 on ( (retail_model_variables.instrument_id = instrument_lgd_baseline_stg_2.instrument_id) AND (retail_model_variables.prediction_year = instrument_lgd_baseline_stg_2.prediction_year) ) WHERE (1 = 1) AND (reporting_date.id = '420') AND (portfolio.id = '2') AND (scenario.scenario_id = '16')"""
___________________________________
STAGE 6 - Model Name :  Retail Secured Loss Forecast
# TASK 0
Task Desc : Compute AutoLoan Losses stage
Target Map name : retail_autoloan_loss_forecast_map
Target Table name : retail_loss_forecast
SQL : """WITH retail_autoloan_loss_forecast_map_dlagcalc_base AS ( SELECT retail_pd.reporting_date as reporting_date, retail_pd.instrument_id as instrument_id, reporting_date.quarter_end_date as prediction_year_q, reporting_date.reporting_date_name as prediction_year, retail_pd.portfolio_id as portfolio_id, retail_pd.scenario_id as scenario_id, retail_pd.model_segment as model_segment_id, retail_pd.pd_baseline as pd_baseline, retail_po.po_baseline as po_baseline, retail_ead.ead_baseline as ead_baseline, retail_exposure.exposure_baseline as exposure_baseline, retail_lgd.lgd_baseline * 0.90 as lgd_baseline, instrument_detail_retail.scheduled_payment_amt as sched_pmt, model_auction_data.avg_auction as avg_auction, ( months_between ( reporting_date.reporting_date_name, CASE WHEN (((instrument_detail_retail.vintage_type = 'New'))) THEN (instrument_detail_retail.new_vintage_date) ELSE (retail_pd.reporting_date) END ) ) as mss, instrument_detail_retail.current_interest_rate as current_int_rate, instrument_detail_retail.loan_effective_interest_rate as effRate, instrument_detail_retail.eom_balance_amt as eom_balance_amt, instrument_detail_retail.fas_ending_balance_amt as fas_ending_balance_amt, instrument_detail_retail.discount_ending_balance_amt as discount_ending_balance_amt, instrument_detail_retail.subvention_ending_balance_amt as subvention_ending_balance_amt, CASE WHEN ( ( ( ( ( months_between ( reporting_date.reporting_date_name, CASE WHEN (((instrument_detail_retail.vintage_type = 'New'))) THEN (instrument_detail_retail.new_vintage_date) ELSE (retail_pd.reporting_date) END ) ) ) = 0 ) ) ) THEN (instrument_detail_retail.eom_balance_amt) ELSE ( greatest( ( fv ( (greatest(instrument_detail_retail.current_interest_rate / 12, 1E-11)), ( ( months_between ( reporting_date.reporting_date_name, CASE WHEN (((instrument_detail_retail.vintage_type = 'New'))) THEN (instrument_detail_retail.new_vintage_date) ELSE (retail_pd.reporting_date) END ) ) ), instrument_detail_retail.scheduled_payment_amt, - instrument_detail_retail.eom_balance_amt, 0 ) ), 0 ) ) END as forebalance_eop, 1 / (1 / retail_pd.pd_baseline - 1) as k1_tmp, 1 / (1 / retail_po.po_baseline - 1) as k2_tmp, 1 / (1 + (1 / (1 / retail_pd.pd_baseline - 1)) + (1 / (1 / retail_po.po_baseline - 1))) as ps_tmp, ((1 / (1 / retail_pd.pd_baseline - 1)) * (1 / (1 + (1 / (1 / retail_pd.pd_baseline - 1)) + (1 / (1 / retail_po.po_baseline - 1))))) as pd_tmp, ((1 / (1 / retail_po.po_baseline - 1)) * (1 / (1 + (1 / (1 / retail_pd.pd_baseline - 1)) + (1 / (1 / retail_po.po_baseline - 1))))) as po_tmp, 1 - POWER(1 - ((((1 / (1 / retail_pd.pd_baseline - 1)) * (1 / (1 + (1 / (1 / retail_pd.pd_baseline - 1)) + (1 / (1 / retail_po.po_baseline - 1))))))), (1 / 3)) as pd_m_tmp, 1 - POWER(1 - ((((1 / (1 / retail_po.po_baseline - 1)) * (1 / (1 + (1 / (1 / retail_pd.pd_baseline - 1)) + (1 / (1 / retail_po.po_baseline - 1))))))), (1 / 3)) as po_m_tmp, 1743661750988 as version FROM 5cddaeb2_1660_45e5_b6d9_eac376c09a0c_1616568471174_1743661748010 as retail_pd JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((reporting_date.quarter_end_date = retail_pd.prediction_year)) JOIN 29d8d80f_c9c5_444e_b794_91c53d3620a4_1616568471045_1743661748649 as retail_po on ( (retail_pd.instrument_id = retail_po.instrument_id) AND (retail_pd.prediction_year = retail_po.prediction_year) ) JOIN 6fcba117_fae5_43b3_a470_dac59cxe83f_1616568471225_1743661748976 as retail_ead on ( (retail_ead.instrument_id = retail_po.instrument_id) AND (retail_ead.prediction_year = retail_po.prediction_year) ) JOIN 1d10c806_f312_4bc7_aaf0_803ca7617f60_1616568471063_1743661749364 as retail_exposure on ( (retail_exposure.instrument_id = retail_po.instrument_id) AND (retail_exposure.prediction_year = retail_po.prediction_year) ) JOIN be8b698c_9d0f_416b_87a4_25d59ec841a8_1616568471281_1743661750005 as retail_lgd on ( (retail_lgd.instrument_id = retail_po.instrument_id) AND (retail_lgd.prediction_year = retail_po.prediction_year) ) JOIN 64761be1_7bb3_45d6_88ef_6a13e3c99bf7_1616568471210_1743661746824 as retail_model_variables on ( (retail_model_variables.instrument_id = retail_po.instrument_id) AND (retail_model_variables.prediction_year = retail_po.prediction_year) ) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((instrument_detail_retail.loan_key = retail_po.instrument_id)) left outer JOIN df1f9b05_727c_48ca_9ffa_abf796c9e550_1616568471085_1616651153728 as model_auction_data on ( (instrument_detail_retail.loss_segmentation_model_name = model_auction_data.model) AND (instrument_detail_retail.collateral_type_desc = model_auction_data.coll_type) AND ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = model_auction_data.flag_tdr ) ) WHERE (1 = 1) AND ( ( ( reporting_date.reporting_date_name >= ( CASE WHEN (((instrument_detail_retail.vintage_type = 'New'))) THEN (instrument_detail_retail.new_vintage_date) ELSE (retail_pd.reporting_date) END ) ) ) ) SORT BY retail_pd.reporting_date, retail_pd.instrument_id, retail_pd.prediction_year ), retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc AS ( SELECT retail_autoloan_loss_forecast_map_dlagcalc_base.reporting_date, retail_autoloan_loss_forecast_map_dlagcalc_base.instrument_id, dlagcalc20 ( sort_array ( collect_list ( struct ( retail_autoloan_loss_forecast_map_dlagcalc_base.prediction_year, array ( CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.prediction_year AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.prediction_year AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.ead_baseline AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.ead_baseline AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.exposure_baseline AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.exposure_baseline AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.lgd_baseline AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.lgd_baseline AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.sched_pmt AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.sched_pmt AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.avg_auction AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.avg_auction AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.mss AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.mss AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.current_int_rate AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.current_int_rate AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.effRate AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.effRate AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.eom_balance_amt AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.eom_balance_amt AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.fas_ending_balance_amt AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.fas_ending_balance_amt AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.discount_ending_balance_amt AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.discount_ending_balance_amt AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.subvention_ending_balance_amt AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.subvention_ending_balance_amt AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.forebalance_eop AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.forebalance_eop AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.pd_m_tmp AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.pd_m_tmp AS DOUBLE) ELSE 0d END, CASE WHEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.po_m_tmp AS DOUBLE) IS NOT NULL THEN CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.po_m_tmp AS DOUBLE) ELSE 0d END, 0d, 0d, 0d, 0d ) as inputValueArr ) ) ), '1; eom_balance_amt;(( discount_ending_balance_amt +  subvention_ending_balance_amt) -  fas_ending_balance_amt); forebalance_eop -  ( (( discount_ending_balance_amt +  subvention_ending_balance_amt) -  fas_ending_balance_amt) ) ', 'Math.max(( survival_rate$dlag1 *(1 -  pd_m_tmp -  po_m_tmp)),0);Math.max(( (  (  postdefaultpayoffprepay$dlag1 )  -  (  (  postdefaultpayoffprepay$dlag1 )  *  pd_m_tmp )  -  (  (  postdefaultpayoffprepay$dlag1 )  *  po_m_tmp )  )  -  (  (  sched_pmt *  exposure_baseline )  -  (  (  (  postdefaultpayoffprepay$dlag1 )  -  (  (  postdefaultpayoffprepay$dlag1 )  *  pd_m_tmp )  -  (  (  postdefaultpayoffprepay$dlag1 )  *  po_m_tmp )  )  * (  current_int_rate/12) )  ) ) ,0);(( ( Math.max( (   amortizedcost$dlag1 * (  effRate/12) )  -  (  (   forebalance_eop$dlag1 )  *   current_int_rate/12 ) ,0) )  > 0) ? (Math.signum(  netfees$dlag1) *(Math.abs(  netfees$dlag1) -  ( Math.max( (   amortizedcost$dlag1 * (  effRate/12) )  -  (  (   forebalance_eop$dlag1 )  *   current_int_rate/12 ) ,0) ) )) :   netfees$dlag1);( ( Math.max( (  amortizedcost$dlag1 * ( effRate/12) )  -  (  (  forebalance_eop$dlag1 )  *  current_int_rate/12 ) ,0) )  > 0) ?  forebalance_eop -  ( (( ( Math.max( (   amortizedcost$dlag1 * (  effRate/12) )  -  (  (   forebalance_eop$dlag1 )  *   current_int_rate/12 ) ,0) )  > 0) ? (Math.signum(  netfees$dlag1) *(Math.abs(  netfees$dlag1) -  ( Math.max( (   amortizedcost$dlag1 * (  effRate/12) )  -  (  (   forebalance_eop$dlag1 )  *   current_int_rate/12 ) ,0) ) )) :   netfees$dlag1) )  : Math.max(com.exeqmode.framework.udf.EXQFinance.fv(Math.max( current_int_rate/12,.00000000001), mss, sched_pmt,- ( (  eom_balance_amt - (( discount_ending_balance_amt +  subvention_ending_balance_amt) -  fas_ending_balance_amt) ) )),0)', 'prediction_year,ead_baseline,exposure_baseline,lgd_baseline,sched_pmt,avg_auction,mss,current_int_rate,effRate,eom_balance_amt,fas_ending_balance_amt,discount_ending_balance_amt,subvention_ending_balance_amt,forebalance_eop,pd_m_tmp,po_m_tmp,survival_rate,postdefaultpayoffprepay,netfees,amortizedcost,prediction_year$dlag1,ead_baseline$dlag1,exposure_baseline$dlag1,lgd_baseline$dlag1,sched_pmt$dlag1,avg_auction$dlag1,mss$dlag1,current_int_rate$dlag1,effRate$dlag1,eom_balance_amt$dlag1,fas_ending_balance_amt$dlag1,discount_ending_balance_amt$dlag1,subvention_ending_balance_amt$dlag1,forebalance_eop$dlag1,pd_m_tmp$dlag1,po_m_tmp$dlag1,survival_rate$dlag1,postdefaultpayoffprepay$dlag1,netfees$dlag1,amortizedcost$dlag1', '1743661750988_6_0' ) AS retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols FROM retail_autoloan_loss_forecast_map_dlagcalc_base AS retail_autoloan_loss_forecast_map_dlagcalc_base GROUP BY retail_autoloan_loss_forecast_map_dlagcalc_base.reporting_date, retail_autoloan_loss_forecast_map_dlagcalc_base.instrument_id ), retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode AS ( SELECT retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc.reporting_date, retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc.instrument_id, explode (retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols) AS retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols FROM retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc ) ( SELECT CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.reporting_date AS string) AS reporting_date, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.instrument_id AS string) AS instrument_id, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.prediction_year_q AS string) AS prediction_year_q, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.portfolio_id AS integer) AS portfolio_id, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.scenario_id AS integer) AS scenario_id, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.model_segment_id AS integer) AS model_segment_id, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.pd_baseline AS double) AS pd_baseline, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.po_baseline AS double) AS po_baseline, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.k1_tmp AS double) AS k1_tmp, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.k2_tmp AS double) AS k2_tmp, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.ps_tmp AS double) AS ps_tmp, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.pd_tmp AS double) AS pd_tmp, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.po_tmp AS double) AS po_tmp, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base.version AS long) AS version, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_0 AS string) AS prediction_year, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_1 AS double) AS ead_baseline, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_2 AS double) AS exposure_baseline, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_3 AS double) AS lgd_baseline, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_4 AS double) AS sched_pmt, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_5 AS double) AS avg_auction, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_6 AS double) AS mss, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_7 AS double) AS current_int_rate, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_8 AS double) AS effRate, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_9 AS double) AS eom_balance_amt, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_10 AS double) AS fas_ending_balance_amt, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_11 AS double) AS discount_ending_balance_amt, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_12 AS double) AS subvention_ending_balance_amt, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_13 AS double) AS forebalance_eop, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_14 AS double) AS pd_m_tmp, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_15 AS double) AS po_m_tmp, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_16 AS double) AS survival_rate, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_17 AS double) AS postdefaultpayoffprepay, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_18 AS double) AS netfees, CAST(retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_19 AS double) AS amortizedcost FROM retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode JOIN retail_autoloan_loss_forecast_map_dlagcalc_base ON retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.reporting_date = retail_autoloan_loss_forecast_map_dlagcalc_base.reporting_date AND retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.instrument_id = retail_autoloan_loss_forecast_map_dlagcalc_base.instrument_id AND retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_explode.retail_autoloan_loss_forecast_map_dlagcalc_base_dlagcalc_allcols.column_0 = retail_autoloan_loss_forecast_map_dlagcalc_base.prediction_year )"""

# TASK 1
Task Desc : Compute AutoLoan ECL Detail
Target Map name : retail_ecl_detail_map
Target Table name : retail_ecl_detail
SQL : """SELECT retail_loss_forecast.reporting_date as reporting_date, retail_loss_forecast.instrument_id as instrument_id, retail_loss_forecast.prediction_year as prediction_year, retail_loss_forecast.portfolio_id as portfolio_id, region.id as region_id, -1 as industry_id, -1 as band_id, retail_loss_forecast.scenario_id as scenario_id, retail_loss_forecast.model_segment_id as model_segment_id, -1 as asset_class_id, CASE WHEN (((instrument_detail_retail.days_past_due_nbr >= 61))) THEN (3) WHEN (((instrument_detail_retail.bankruptcy_key > 0))) THEN (3) WHEN ( ( (instrument_detail_retail.tdr_policy_exempt_ind_ifrs9 = 'N') AND ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (3) WHEN (((instrument_detail_retail.class_code in ('PX', 'CX', 'BX')))) THEN (3) WHEN ( ( ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (2) WHEN ( ( (instrument_detail_retail.days_past_due_nbr >= 31) AND (instrument_detail_retail.days_past_due_nbr <= 60) ) ) THEN (2) WHEN ( ( ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) IS NOT null ) AND ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) <= -100 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) >= 561 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) <= 900 ) ) ) THEN (2) WHEN ( ( ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) IS NOT null ) AND ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) <= -80 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) >= 501 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) <= 560 ) ) ) THEN (2) WHEN ( ( ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) IS NOT null ) AND ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) <= -60 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) >= 250 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) <= 500 ) ) ) THEN (2) ELSE (1) END as stage_id, CASE WHEN (((instrument_detail_retail.days_past_due_nbr >= 61))) THEN (1) WHEN ( ( (instrument_detail_retail.bankruptcy_key > 0) OR (instrument_detail_retail.bk_write_down_ind = 'Y') ) ) THEN (2) WHEN ( ( (instrument_detail_retail.joint_ind = 'N') AND (instrument_detail_retail.class_code in ('PX', 'CX', 'BX')) ) ) THEN (3) WHEN ( ( (instrument_detail_retail.joint_ind = 'Y') AND (instrument_detail_retail.class_code = 'BX') ) ) THEN (3) WHEN ( ( ( ( CASE WHEN (((instrument_detail_retail.tdr_ind = 'Y'))) THEN (1) ELSE (0) END ) = 1 ) ) ) THEN (4) WHEN ( ( (instrument_detail_retail.days_past_due_nbr >= 31) AND (instrument_detail_retail.days_past_due_nbr <= 60) ) ) THEN (5) WHEN ( ( ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) IS NOT null ) AND ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) <= -100 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) >= 561 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) <= 900 ) ) ) THEN (6) WHEN ( ( ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) IS NOT null ) AND ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) <= -80 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) >= 501 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) <= 560 ) ) ) THEN (6) WHEN ( ( ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) IS NOT null ) AND ( ( CASE WHEN ( ( ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) IS NOT null ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) IS NOT null ) ) ) THEN ( ( CASE WHEN ( ( (instrument_detail_retail.current_credit_score_nbr < 250) OR (instrument_detail_retail.current_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.current_credit_score_nbr) END ) - ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) ) ELSE (null) END ) <= -60 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) >= 250 ) AND ( ( CASE WHEN ( ( (instrument_detail_retail.original_credit_score_nbr < 250) OR (instrument_detail_retail.original_credit_score_nbr > 900) ) ) THEN (null) ELSE (instrument_detail_retail.original_credit_score_nbr) END ) <= 500 ) ) ) THEN (6) ELSE (7) END as stage_new_id, -1 as product_type_id, -1 as ltv_bucket_id, -1 as legal_entity_id, -1 as approach_id, retail_loss_forecast.pd_baseline as predicted_pd_base, retail_loss_forecast.lgd_baseline as predicted_lgd_base, retail_loss_forecast.ead_baseline as predicted_ead_base, retail_loss_forecast.po_baseline as predicted_po_base, retail_loss_forecast.exposure_baseline as predicted_pp_base, retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as marginal_pd_base, retail_loss_forecast.forebalance_eop as predicted_ead, retail_loss_forecast.eom_balance_amt as nominal_exposure, Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) as gross_loss, Greatest( ( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop ) * retail_loss_forecast.lgd_baseline - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) as net_loss, CASE WHEN ( ( ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) > 0 ) ) ) THEN ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.avg_auction ) ELSE (0) END as cost_to_sell, CASE WHEN ( ( ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) > 0 ) ) ) THEN ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) * retail_loss_forecast.effRate / 12 ) ELSE (0) END as foregone_interest, ( Greatest( ( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop ) * retail_loss_forecast.lgd_baseline - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) + ( CASE WHEN ( ( ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) > 0 ) ) ) THEN ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.avg_auction ) ELSE (0) END ) as ecl, ( ( Greatest( ( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop ) * retail_loss_forecast.lgd_baseline - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) * 1 * 1.0274 + ( CASE WHEN ( ( ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) > 0 ) ) ) THEN ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.avg_auction ) ELSE (0) END ) ) / (POWER((1 + retail_loss_forecast.effRate), (retail_loss_forecast.mss / 12))) as ecl_discounted, retail_loss_forecast.effRate as eir, retail_loss_forecast.mss as days_diff, retail_loss_forecast.mss as days_period, SUM( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) ) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as cum_gross_loss, SUM( ( Greatest( ( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop ) * retail_loss_forecast.lgd_baseline - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) ) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as cum_net_loss, SUM( ( CASE WHEN ( ( ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) > 0 ) ) ) THEN ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.avg_auction ) ELSE (0) END ) ) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as cum_cost_to_sell, SUM( ( CASE WHEN ( ( ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) > 0 ) ) ) THEN ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) * retail_loss_forecast.effRate / 12 ) ELSE (0) END ) ) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as cum_foregone_interest, SUM( ( ( Greatest( ( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop ) * retail_loss_forecast.lgd_baseline - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) + ( CASE WHEN ( ( ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) > 0 ) ) ) THEN ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.avg_auction ) ELSE (0) END ) ) ) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as cum_ecl, SUM( ( ( ( Greatest( ( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop ) * retail_loss_forecast.lgd_baseline - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) * 1 * 1.0274 + ( CASE WHEN ( ( ( ( Greatest( ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.ead_baseline * retail_loss_forecast.forebalance_eop - ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost) ), 0 ) ) > 0 ) ) ) THEN ( ( retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * retail_loss_forecast.avg_auction ) ELSE (0) END ) ) / (POWER((1 + retail_loss_forecast.effRate), (retail_loss_forecast.mss / 12))) ) ) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as cum_ecl_discounted, retail_loss_forecast.forebalance_eop - retail_loss_forecast.amortizedcost as prem_amount, 1743661751968 as version, LAG(retail_loss_forecast.forebalance_eop, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as forebalance_bop, ( LAG(retail_loss_forecast.forebalance_eop, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) - retail_loss_forecast.forebalance_eop as prinpaid_sched, retail_loss_forecast.eom_balance_amt - ((retail_loss_forecast.discount_ending_balance_amt + retail_loss_forecast.subvention_ending_balance_amt) - retail_loss_forecast.fas_ending_balance_amt) as amortizedcost_snap, retail_loss_forecast.pd_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as pd_surv, retail_loss_forecast.po_m_tmp * LAG(retail_loss_forecast.survival_rate, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as po_surv, LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) as behavioral_bopbalance, ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * pd_m_tmp as defaultamount, ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * po_m_tmp as payoffamount, ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) - ( ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * pd_m_tmp ) - ( ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * po_m_tmp ) as postdefaultpayoff, ( ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) - ( ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * pd_m_tmp ) - ( ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * po_m_tmp ) ) * (retail_loss_forecast.current_int_rate / 12) as interestowed, retail_loss_forecast.sched_pmt * retail_loss_forecast.exposure_baseline as observedpayment, (retail_loss_forecast.sched_pmt * retail_loss_forecast.exposure_baseline) - ( ( ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) - ( ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * pd_m_tmp ) - ( ( LAG(retail_loss_forecast.postdefaultpayoffprepay, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * po_m_tmp ) ) * (retail_loss_forecast.current_int_rate / 12) ) as principalpaid, ( LAG(retail_loss_forecast.amortizedcost, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.effRate / 12) as interestincome, ( LAG(retail_loss_forecast.forebalance_eop, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.current_int_rate / 12) as statedinterest, Greatest( ( ( LAG(retail_loss_forecast.amortizedcost, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.effRate / 12) ) - ( ( LAG(retail_loss_forecast.forebalance_eop, 1, 0) OVER ( PARTITION BY retail_loss_forecast.instrument_id ORDER BY retail_loss_forecast.prediction_year ) ) * (retail_loss_forecast.current_int_rate / 12) ), 0 ) as feesamortization FROM 4fefddd3_90b8_45a8_9d52_47c1819a5c72_1616568471124_1743661750988 as retail_loss_forecast JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((retail_loss_forecast.reporting_date = reporting_date.reporting_date_name)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ((retail_loss_forecast.portfolio_id = portfolio.id)) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ((retail_loss_forecast.scenario_id = scenario.scenario_id)) JOIN e0fa9b6e_d8eb_4c61_949e_3ccf467580bb_1616568471265_1616570826147 as model_segment on ((retail_loss_forecast.model_segment_id = model_segment.id)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((retail_loss_forecast.instrument_id = instrument_detail_retail.loan_key)) JOIN edeadbf2_e67c_4bdb_95e6_339c00f09498_1616568471073_1704779020041 as region on ((instrument_detail_retail.residence_state_code = region.code)) WHERE (1 = 1) AND (reporting_date.id = '420') AND (portfolio.id = '2') AND (scenario.scenario_id = '16')"""

# TASK 2
Task Desc : Aggregrate AutoLoan ECL Loanwise
Target Map name : retail_ecl_map
Target Table name : retail_ecl
SQL : """SELECT retail_ecl_detail.reporting_date as reporting_date, retail_ecl_detail.instrument_id as instrument_id, retail_ecl_detail.portfolio_id as portfolio_id, retail_ecl_detail.region_id as region_id, retail_ecl_detail.industry_id as industry_id, retail_ecl_detail.band_id as band_id, retail_ecl_detail.scenario_id as scenario_id, retail_ecl_detail.model_segment_id as segment_id, retail_ecl_detail.product_type_id as product_type_id, retail_ecl_detail.approach_id as approach_id, retail_ecl_detail.asset_class_id as asset_class_id, retail_ecl_detail.legal_entity_id as legal_entity_id, fico_score_band.id as fico_score_band_id, -1 as ltv_bucket_id, retail_ecl_detail.stage_id as stage_id, retail_ecl_detail.stage_new_id as stage_new_id, MAX(retail_ecl_detail.nominal_exposure) as nominal_exposure, SUM(retail_ecl_detail.gross_loss) as gross_loss, SUM(retail_ecl_detail.net_loss) as net_loss, SUM(retail_ecl_detail.cost_to_sell) as cost_to_sell, SUM(retail_ecl_detail.foregone_interest) as foregone_interest, ( SUM( CASE WHEN ( ( (retail_ecl_detail.stage_id = 1) AND (retail_ecl_detail.prediction_year <= (add_months(retail_ecl_detail.reporting_date, 12))) ) ) THEN (retail_ecl_detail.ecl) WHEN (((retail_ecl_detail.stage_id in (2, 3)))) THEN (retail_ecl_detail.ecl) ELSE (0) END ) ) as ecl, SUM(retail_ecl_detail.ecl_discounted) as ecl_discounted, MAX(retail_ecl_detail.cum_gross_loss) as cum_gross_loss, MAX(retail_ecl_detail.cum_net_loss) as cum_net_loss, MAX(retail_ecl_detail.cum_cost_to_sell) as cum_cost_to_sell, MAX(retail_ecl_detail.cum_foregone_interest) as cum_foregone_interest, MAX(retail_ecl_detail.cum_ecl) as cum_ecl, MAX(retail_ecl_detail.cum_ecl_discounted) as cum_ecl_discounted, ( SUM( CASE WHEN (((retail_ecl_detail.prediction_year <= (add_months(retail_ecl_detail.reporting_date, 12))))) THEN (retail_ecl_detail.ecl) ELSE (0) END ) ) as 12m_ecl, ( SUM( CASE WHEN (((retail_ecl_detail.prediction_year <= (add_months(retail_ecl_detail.reporting_date, 12))))) THEN (retail_ecl_detail.ecl_discounted) ELSE (0) END ) ) as 12m_ecl_discounted, ( SUM( CASE WHEN (((retail_ecl_detail.prediction_year <= (add_months(retail_ecl_detail.reporting_date, 24))))) THEN (retail_ecl_detail.ecl) ELSE (0) END ) ) as 24m_ecl, ( SUM( CASE WHEN (((retail_ecl_detail.prediction_year <= (add_months(retail_ecl_detail.reporting_date, 24))))) THEN (retail_ecl_detail.ecl_discounted) ELSE (0) END ) ) as 24m_ecl_discounted, 1743661752468 as version, ( SUM( CASE WHEN ( ( (retail_ecl_detail.stage_id = 1) AND (retail_ecl_detail.prediction_year <= (add_months(retail_ecl_detail.reporting_date, 12))) ) ) THEN (retail_ecl_detail.ecl) WHEN (((retail_ecl_detail.stage_id in (2, 3)))) THEN (retail_ecl_detail.ecl) ELSE (0) END ) ) as ecl_final FROM 297b3fbb_71ac_403f_rere_6e5bcf2662d2_1616568471027_1743661751968 as retail_ecl_detail JOIN f2cf16ab_b663_4757_b7fb_d07ac5526166_1589266253833_1616570851091 as reporting_date on ((retail_ecl_detail.reporting_date = reporting_date.reporting_date_name)) JOIN f24da1f8_11a1_4907_b8c1_ae096fbf5d5c_1698127963213_1716034451481 as scenario on ((retail_ecl_detail.scenario_id = scenario.scenario_id)) JOIN 719c29e4_727d_44cb_b79b_5d1ee327f0e5_1589266253467_1687782530694 as portfolio on ((retail_ecl_detail.portfolio_id = portfolio.id)) JOIN f0666d21_20e5_4d3f_bee7_ee1a4192bec9_1620919773729_1716037965376 as instrument_detail_retail on ((retail_ecl_detail.instrument_id = instrument_detail_retail.loan_key)) JOIN c4544679_815c_27e1_6418_6d8dd92a5df4_1616568471152_1616570429360 as fico_score_band on ( (instrument_detail_retail.current_credit_score_nbr >= fico_score_band.band_ll) AND (instrument_detail_retail.current_credit_score_nbr <= fico_score_band.band_ul) ) WHERE (1 = 1) AND (reporting_date.id = '420') AND (portfolio.id = '2') AND (scenario.scenario_id = '16') GROUP BY retail_ecl_detail.reporting_date, retail_ecl_detail.instrument_id, retail_ecl_detail.portfolio_id, retail_ecl_detail.region_id, retail_ecl_detail.industry_id, retail_ecl_detail.band_id, retail_ecl_detail.scenario_id, retail_ecl_detail.model_segment_id, retail_ecl_detail.product_type_id, retail_ecl_detail.approach_id, retail_ecl_detail.asset_class_id, retail_ecl_detail.legal_entity_id, fico_score_band.id, retail_ecl_detail.stage_id, retail_ecl_detail.stage_new_id"""